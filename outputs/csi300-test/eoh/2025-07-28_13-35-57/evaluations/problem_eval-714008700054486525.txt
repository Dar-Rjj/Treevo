import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Calculate the 20-period moving average
    ma_20 = df['close'].rolling(window=20).mean()
    
    # Ratio of close price to its 20-period moving average
    ratio_ma20 = df['close'] / ma_20
    
    # Calculate the SMA for 'volume'
    sma_volume = df['volume'].rolling(window=20).mean()
    
    # Relative Strength Index (RSI) of daily returns
    daily_returns = df['close'].pct_change().fillna(0)
    avg_gain = daily_returns.rolling(window=14).apply(lambda x: np.mean(x[x > 0]), raw=False)
    avg_loss = abs(daily_returns.rolling(window=14).apply(lambda x: np.mean(x[x < 0]), raw=False))
    rs = avg_gain / avg_loss
    rsi = 100 - (100 / (1 + rs))
    
    # Determine dynamic weights based on the RSI
    weight_ratio = rsi / 100
    weight_sma = 1 - weight_ratio
    
    # Compute the heuristic factor
    heuristics_matrix = (ratio_ma20 * weight_ratio) + (sma_volume * weight_sma)
    
    return heuristics_matrix
