import pandas as pd

def heuristics_v2(df):
    n = 20
    df['PriceRange'] = df['high'] - df['low']
    df['CloseToRangeRatio'] = df['close'] / df['PriceRange']
    df['LogVolume'] = df['volume'].apply(lambda x: max(1, x)).apply(lambda x: np.log(x))
    heuristics_matrix = (df['CloseToRangeRatio'] * df['LogVolume']).rolling(window=n).mean()
    return heuristics_matrix
