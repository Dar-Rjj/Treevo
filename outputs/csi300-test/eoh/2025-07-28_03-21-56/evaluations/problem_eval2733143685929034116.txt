def heuristics_v2(df):
    def compute_ema(series, window):
        return series.ewm(span=window, adjust=False).mean()
    
    def compute_atr(high, low, close, window=14):
        high_low = high - low
        high_close = (high - close.shift(1)).abs()
        low_close = (low - close.shift(1)).abs()
        tr = pd.concat([high_low, high_close, low_close], axis=1).max(axis=1)
        atr = tr.rolling(window=window).mean()
        return atr

    df['ema_short'] = compute_ema(df['close'], 10)
    df['ema_long'] = compute_ema(df['close'], 30)
    df['trend_signal'] = df['ema_short'] - df['ema_long']
    
    df['atr'] = compute_atr(df['high'], df['low'], df['close'])
    
    heuristics_matrix = df['trend_signal'] / df['atr']
    return heuristics_matrix
