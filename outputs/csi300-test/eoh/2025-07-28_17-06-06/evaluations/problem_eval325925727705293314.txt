import pandas as pd

def heuristics_v2(df):
    # Calculate daily return and volume change
    df['daily_return'] = df['close'].pct_change()
    df['volume_change'] = df['volume'].pct_change()
    
    # Compute the standard deviation for recent price and volume changes
    df['price_std'] = df['daily_return'].rolling(window=30).std().fillna(0)
    df['volume_std'] = df['volume_change'].rolling(window=30).std().fillna(0)
    
    # Assign weights dynamically based on the standard deviation of daily return and volume change
    df['price_weight'] = (df['price_std'] / (df['price_std'] + df['volume_std']))
    df['volume_weight'] = 1 - df['price_weight']
    
    # Calculate the exponential moving average (EMA) for close price and volume
    df['ema_close'] = df['close'].ewm(span=30, adjust=False).mean().fillna(0)
    df['ema_volume'] = df['volume'].ewm(span=30, adjust=False).mean().fillna(0)
    
    # Calculate the weighted sum of EMAs
    df['weighted_sum'] = (df['ema_close'] * df['price_weight']) + (df['ema_volume'] * df['volume_weight'])
    
    # Create the heuristics matrix
    heuristics_matrix = df['weighted_sum']
    
    return heuristics_matrix
