def heuristics_v2(df):
    df['price_change'] = df['close'].diff()
    df['positive_changes'] = df['price_change'].apply(lambda x: max(x, 0))
    df['negative_changes'] = df['price_change'].apply(lambda x: abs(min(x, 0)))
    df['pos_neg_ratio'] = df['positive_changes'] / (df['negative_changes'] + 1e-8)  # Avoid division by zero
    df['pos_neg_ratio_ema'] = df['pos_neg_ratio'].ewm(span=20, adjust=False).mean()
    heuristics_matrix = df['pos_neg_ratio_ema'].dropna()
    return heuristics_matrix
