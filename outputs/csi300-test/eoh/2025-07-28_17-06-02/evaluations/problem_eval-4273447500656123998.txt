def heuristics_v2(df):
    # Exponential Moving Averages
    ema_7 = df['close'].ewm(span=7, adjust=False).mean()
    ema_21 = df['close'].ewm(span=21, adjust=False).mean()
    ema_ratio = (ema_7 / ema_21) - 1
    
    # Chaikin Money Flow (CMF)
    money_flow_multiplier = ((df['close'] - df['low']) - (df['high'] - df['close'])) / (df['high'] - df['low'])
    money_flow_volume = money_flow_multiplier * df['volume']
    cmf = money_flow_volume.rolling(window=14).sum() / df['volume'].rolling(window=14).sum()
    
    # Aroon Oscillator
    aroon_up = df['high'].rolling(window=28).apply(lambda x: (x.argmax() + 1) / 28 * 100, raw=True)
    aroon_down = df['low'].rolling(window=28).apply(lambda x: (x.argmin() + 1) / 28 * 100, raw=True)
    aroon_oscillator = aroon_up - aroon_down
    
    # Price weighted by volume
    price_weighted = (df['open'] + df['high'] + df['low'] + df['close']) / 4 * df['volume']
    
    # Composite heuristic
    heuristics_matrix = (ema_ratio + cmf + aroon_oscillator + price_weighted) / 4
    return heuristics_matrix
