def heuristics_v2(df):
    # Oscillator based on the difference between close and open prices
    price_diff = df['close'] - df['open']
    smoothed_price_diff = price_diff.ewm(span=14, adjust=False).mean()
    
    # Stochastic Oscillator
    lowest_low = df['low'].rolling(window=14).min()
    highest_high = df['high'].rolling(window=14).max()
    k = 100 * (df['close'] - lowest_low) / (highest_high - lowest_low)
    d = k.rolling(window=3).mean()
    
    # Volume Flow Ratio
    positive_volume = df['volume'].where(df['close'] > df['open'], 0)
    negative_volume = df['volume'].where(df['close'] < df['open'], 0)
    volume_flow_ratio = positive_volume.rolling(window=21).sum() / negative_volume.rolling(window=21).sum()
    
    # Composite heuristic
    heuristics_matrix = (smoothed_price_diff + k + d + volume_flow_ratio) / 4
    return heuristics_matrix
