import pandas as pd

def heuristics_v2(df):
    # Calculate 14-day Williams %R
    hh = df['high'].rolling(window=14).max()
    ll = df['low'].rolling(window=14).min()
    williams_r = -100 * ((hh - df['close']) / (hh - ll))
    
    # Calculate 20-period MACD and its 9-day signal line
    ema_12 = df['close'].ewm(span=12, adjust=False).mean()
    ema_26 = df['close'].ewm(span=26, adjust=False).mean()
    macd = ema_12 - ema_26
    signal_line = macd.ewm(span=9, adjust=False).mean()
    macd_signal_diff = macd - signal_line
    
    # Calculate 30-day standard deviation of the closing price
    std_30 = df['close'].rolling(window=30).std()
    
    # Close price weighted by volume
    close_weighted_by_volume = df['close'] * df['volume']
    
    # Composite heuristic
    heuristics_matrix = (williams_r + macd_signal_diff - std_30 + close_weighted_by_volume) / 4
    return heuristics_matrix
