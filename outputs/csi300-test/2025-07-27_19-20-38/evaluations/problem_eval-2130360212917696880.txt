import pandas as pd

def heuristics_v2(df):
    # Calculate the Average True Range (ATR) over 14 days as a measure of volatility
    tr = df[['high', 'low', 'close']].join(df[['high', 'low', 'close']].shift(1)).apply(lambda x: max(x[0], x[3]) - min(x[1], x[4]), axis=1)
    atr = tr.rolling(window=14).mean()
    
    # Anomaly detection: Daily high-low range / ATR
    anomaly_ratio = (df['high'] - df['low']) / atr
    
    # Trend adherence: Close price / 50-day simple moving average
    sma_50 = df['close'].rolling(window=50).mean()
    trend_adherence = df['close'] / sma_50
    
    # Combine factors into a single alpha factor
    heuristics_matrix = 0.7 * anomaly_ratio + 0.3 * trend_adherence
    
    return heuristics_matrix
