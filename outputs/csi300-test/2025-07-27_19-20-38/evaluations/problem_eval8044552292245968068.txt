def heuristics_v2(df):
    def log_change(column):
        return column.pct_change().apply(lambda x: np.log(1 + x))
    
    def adx(high, low, close, period=14):
        plus_dm = high.diff()
        minus_dm = low.diff()
        tr = pd.DataFrame({'tr1': high - low,
                           'tr2': (high - close.shift()).abs(),
                           'tr3': (low - close.shift()).abs()}).max(axis=1)
        plus_di = 100 * (plus_dm.ewm(alpha=1/period).mean() / tr.ewm(alpha=1/period).mean())
        minus_di = 100 * (minus_dm.abs().ewm(alpha=1/period).mean() / tr.ewm(alpha=1/period).mean())
        dx = (plus_di - minus_di).abs() / (plus_di + minus_di)
        adx_series = dx.ewm(alpha=1/period).mean()
        return adx_series
    
    def money_flow_ratio(price, volume):
        positive_money_flow = (price > price.shift()) * (price * volume)
        negative_money_flow = (price < price.shift()) * (price * volume)
        total_positive_money_flow = positive_money_flow.rolling(window=14).sum()
        total_negative_money_flow = negative_money_flow.rolling(window=14).sum()
        return total_positive_money_flow / (total_negative_money_flow + 1e-6)  # Avoid division by zero

    log_price_change = log_change(df['close'])
    adx_index = adx(df['high'], df['low'], df['close'])
    typical_price = (df['high'] + df['low'] + df['close']) / 3
    mfr = money_flow_ratio(typical_price, df['volume'])

    heuristics_matrix = 0.5*log_price_change + 0.3*adx_index + 0.2*mfr
    return heuristics_matrix
