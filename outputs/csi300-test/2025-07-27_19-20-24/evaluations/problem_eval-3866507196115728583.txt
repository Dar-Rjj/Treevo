import pandas as pd

def heuristics_v2(df):
    # Long-term price trend: 9-month moving average of closing prices
    long_trend = df['close'].rolling(window=180).mean().pct_change(180)
    
    # Medium-term trading activity anomaly: Z-score of volume over the last 40 days
    vol_zscore_40 = (df['volume'] - df['volume'].rolling(window=40).mean()) / df['volume'].rolling(window=40).std()
    
    # Short-term directional movement: 7-day difference between highest high and lowest low
    dir_movement_7 = (df['high'].rolling(window=7).max() - df['low'].rolling(window=7).min()) / df['close']
    
    # Composite heuristic score
    heuristics_matrix = 0.5 * long_trend + 0.3 * vol_zscore_40 + 0.2 * dir_movement_7
    
    return heuristics_matrix
