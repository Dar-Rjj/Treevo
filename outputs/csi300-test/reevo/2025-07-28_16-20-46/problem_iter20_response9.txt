```python
def heuristics_v2(df: pd.DataFrame) -> pd.Series:
    # Calculate the 5-day and 20-day simple moving average of closing prices to capture momentum
    df['SMA_5'] = df['close'].rolling(window=5).mean()
    df['SMA_20'] = df['close'].rolling(window=20).mean()

    # Momentum factor: difference between 5-day and 20-day moving averages
    df['momentum_factor'] = df['SMA_5'] - df['SMA_20']

    # Calculate the 20-day standard deviation of closing prices to capture volatility
    df['volatility_factor'] = df['close'].rolling(window=20).std()

    # Calculate the 5-day rolling sum of volume to capture liquidity
    df['liquidity_factor'] = df['volume'].rolling(window=5).sum()

    # Calculate relative strength as the ratio of current close to 20-day SMA
    df['relative_strength'] = df['close'] / df['SMA_20']

    # Calculate market breadth: difference between 5-day and 20-day moving averages of (high - low)
    df['range_5'] = (df['high'] - df['low']).rolling(window=5).mean()
    df['range_20'] = (df['high'] - df['low']).rolling(window=20).mean()
    df['market_breadth'] = df['range_5'] - df['range_20']

    # Calculate logarithmic returns
    df['log_return'] = np.log(df['close'] / df['close'].shift(1))

    # Advanced indicators
    df['money_flow_index'] = money_flow_index(df['high'], df['low'], df['close'], df['volume'], window=14)
    df['rsi'] = rsi(df['close'], window=14)

    # Adaptive weights for the factors
    df['momentum_weight'] = df['volatility_factor'].rank(pct=True)
    df['liquidity_weight'] = df['liquidity_factor'].rank(pct=True)
    df['relative_strength_weight'] = df['relative_strength'].rank(pct=True)
    df['market_breadth_weight'] = df['market_breadth'].rank(pct=True)
    df['log_return_weight'] = df['log_return'].rank(pct=True)
    df['mfi_weight'] = df['money_flow_index'].rank(pct=True)
    df['rsi_weight'] = df['rsi'].rank(pct=True)

    # Calculate the 5-day exponential moving average of the momentum factor
    df['EMA_momentum'] = df['momentum_factor'].ewm(span=5, adjust=False).mean()

    # Combine the factors with adaptive weights
    heuristic_factor = (df['EMA_momentum'] * df['momentum_weight']) + \
                       (df['liquidity_factor'] * df['liquidity_weight']) + \
                       (df['relative_strength'] * df['relative_strength_weight']) + \
                       (df['market_breadth'] * df['market_breadth_weight']) + \
                       (df['log_return'] * df['log_return_weight']) + \
                       (df['money_flow_index'] * df['mfi_weight']) + \
                       (df['rsi'] * df['rsi_weight'])

    # Consider market regime changes
    df['regime'] = (df['log_return'] > 0).rolling(window=20).mean() > 0.6
    heuristic_factor = heuristic_factor * (1 + df['regime'])

    return heuristic_factor

def money_flow_index(high, low, close, volume, window):
    typical_price = (high + low + close) / 3
    raw_money_flow = typical_price * volume
    positive_money_flow = raw_money_flow.where((typical_price > typical_price.shift()), 0)
    negative_money_flow = raw_money_flow.where((typical_price < typical_price.shift()), 0)
    positive_flow_sum = positive_money_flow.rolling(window=window).sum()
    negative_flow_sum = negative_money_flow.rolling(window=window).sum()
    money_ratio = positive_flow_sum / negative_flow_sum
    mfi = 100 - (100 / (1 + money_ratio))
    return mfi

def rsi(close, window):
    delta = close.diff()
    gain = delta.where(delta > 0, 0)
    loss = -delta.where(delta < 0, 0)
    avg_gain = gain.rolling(window=window).mean()
    avg_loss = loss.rolling(window=window).mean()
    rs = avg_gain / avg_loss
    rsi = 100 - (100 / (
