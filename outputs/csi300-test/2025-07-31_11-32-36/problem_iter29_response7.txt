```python
import pandas as pd

def heuristics_v2(df):
    # Calculate the 5-day and 20-day simple moving averages for prices
    df['SMA5'] = df['close'].rolling(window=5).mean()
    df['SMA20'] = df['close'].rolling(window=20).mean()
    
    # Compute the difference between SMA5 and SMA20
    df['SMA_diff'] = df['SMA5'] - df['SMA20']
    
    # Calculate the 5-day and 20-day simple moving averages for volume
    df['VMA5'] = df['volume'].rolling(window=5).mean()
    df['VMA20'] = df['volume'].rolling(window=20).mean()
    
    # Compute the difference between VMA5 and VMA20
    df['VMA_diff'] = df['VMA5'] - df['VMA20']
    
    # Identify bullish and bearish engulfing patterns
    df['prev_close'] = df['close'].shift(1)
    df['bullish_engulfing'] = (df['open'] > df['prev_close']) & (df['close'] < df['open']) & (df['close'] > df['prev_close'])
    df['bearish_engulfing'] = (df['open'] < df['prev_close']) & (df['close'] > df['open']) & (df['close'] < df['prev_close'])
    
    # Convert detected patterns into a binary factor
    df['pattern_factor'] = df['bullish_engulfing'].astype(int) - df['bearish_engulfing'].astype(int)
    
    # Calculate the ratio of volume to price
    df['vol_price_ratio'] = df['volume'] / df['close']
    
    # Compute the 5-day and 20-day average of the volume-to-price ratio
    df['vol_price_ratio_5'] = df['vol_price_ratio'].rolling(window=5).mean()
    df['vol_price_ratio_20'] = df['vol_price_ratio'].rolling(window=20).mean()
    
    # Calculate the difference between the 5-day and 20-day volume-to-price ratios
    df['vol_price_ratio_diff'] = df['vol_price_ratio_5'] - df['vol_price_ratio_20']
    
    # Calculate the daily range (high - low)
    df['daily_range'] = df['high'] - df['low']
    
    # Compute the 5-day and 20-day average of the daily range
    df['range_5'] = df['daily_range'].rolling(window=5).mean()
    df['range_20'] = df['daily_range'].rolling(window=20).mean()
    
    # Calculate the difference between the 5-day and 20-day average ranges
    df['range_diff'] = df['range_5'] - df['range_20']
    
    # Calculate the daily true range (max(high, prev_close) - min(low, prev_close))
    df['true_range'] = df[['high', 'prev_close']].max(axis=1) - df[['low', 'prev_close']].min(axis=1)
    
    # Compute the 5-day and 20-day average of the true range
    df['true_range_5'] = df['true_range'].rolling(window=5).mean()
    df['true_range_20'] = df['true_range'].rolling(window=20).mean()
    
    # Calculate the difference between the 5-day and 20-day average true ranges
    df['true_range_diff'] = df['true_range_5'] - df['true_range_20']
    
    # Combine price and volume factors
    df['price_volume_factor'] = df['SMA_diff'] * df['VMA_diff'] + df['vol_price_ratio_diff']
    
    # Incorporate pattern and range factors
    df['pattern_range_factor'] = df['pattern_factor'] * df['range_diff'] + df['true_range_diff']
    
    # Create a final composite factor
    df['composite_factor'] = df['price_volume_factor'] + df['pattern_range_factor']
    
    return df['composite_factor']
```
