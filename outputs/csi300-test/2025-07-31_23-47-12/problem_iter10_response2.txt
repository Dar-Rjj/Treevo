```python
import pandas as pd
import numpy as np

def heuristics_v2(data, N=20, P=60, M=30, momentum_weight=0.5, volume_weight=0.3, volatility_weight=0.2):
    # Ensure the weights sum to 1
    assert abs(momentum_weight + volume_weight + volatility_weight - 1) < 1e-6, "Weights must sum to 1"

    # Step 1: Calculate Log Returns
    close_prices = data['close']
    log_returns = np.log(close_prices).diff()

    # Step 2: Compute Momentum
    cum_log_returns = log_returns.rolling(window=N).sum()
    
    # Define dynamic thresholds and clip returns
    upper_threshold = cum_log_returns.quantile(0.9)
    lower_threshold = cum_log_returns.quantile(0.1)
    clipped_momentum = np.clip(cum_log_returns, lower_threshold, upper_threshold)

    # Step 3: Adjust for Volume
    volumes = data['volume']
    mean_volume = volumes.rolling(window=P).mean()
    volume_ratio = volumes / mean_volume
    adjusted_momentum = clipped_momentum * volume_ratio

    # Step 4: Determine Absolute Price Changes
    abs_price_changes = close_prices.diff().abs()

    # Step 5: Calculate Advanced Volatility Measures
    std_volatility = abs_price_changes.rolling(window=M).std()
    ema_abs_price_changes = abs_price_changes.ewm(span=M).mean()
    iqr_abs_price_changes = abs_price_changes.rolling(window=M).quantile(0.75) - abs_price_changes.rolling(window=M).quantile(0.25)
    
    # Combine volatility measures
    total_volatility = (std_volatility + ema_abs_price_changes + iqr_abs_price_changes) / 3

    # Step 6: Final Factor Calculation
    weighted_momentum = adjusted_momentum * momentum_weight
    weighted_volume = volume_ratio * volume_weight
    weighted_volatility = total_volatility * volatility_weight

    # Combine the weighted components
    factor_values = weighted_momentum + weighted_volume - weighted_volatility  # Subtracting volatility to penalize high volatility
    
    return factor_values
```
