```python
import pandas as pd
import numpy as np

def heuristics_v2(df, N=20, M=10):
    # Calculate Log Returns
    df['log_returns'] = np.log(df['close']).diff()
    
    # Compute Momentum
    df['cumulative_log_returns'] = df['log_returns'].rolling(window=N).sum()
    upper_threshold = df['log_returns'].quantile(0.95)
    lower_threshold = df['log_returns'].quantile(0.05)
    df['clipped_returns'] = df['log_returns'].clip(lower=lower_threshold, upper=upper_threshold)
    df['momentum'] = df['clipped_returns'].rolling(window=N).sum()
    
    # Adjust for Volume
    mean_volume = df['volume'].rolling(window=N).mean()
    df['volume_adjusted_momentum'] = (df['volume'] / mean_volume) * df['momentum']
    
    # Determine Absolute Price Changes
    df['abs_price_change'] = df['close'].diff().abs()
    
    # Calculate Advanced Volatility Measures
    df['std_abs_price_change'] = df['abs_price_change'].rolling(window=M).std()
    df['ema_abs_price_change'] = df['abs_price_change'].ewm(span=M, adjust=False).mean()
    df['iqr_abs_price_change'] = df['abs_price_change'].rolling(window=M).quantile(0.75) - df['abs_price_change'].rolling(window=M).quantile(0.25)
    
    # Final Factor Calculation
    w_momentum = 0.4
    w_std = 0.3
    w_ema = 0.2
    w_iqr = 0.1
    
    df['factor_value'] = (
        w_momentum * df['volume_adjusted_momentum'] +
        w_std * df['std_abs_price_change'] +
        w_ema * df['ema_abs_price_change'] +
        w_iqr * df['iqr_abs_price_change']
    )
    
    # Integrate Market Breadth Indicators
    df['advance_decline'] = df['close'].diff().apply(lambda x: 1 if x > 0 else (-1 if x < 0 else 0)).cumsum()
    df['new_highs'] = df['close'].rolling(window=N).max() == df['close']
    df['new_lows'] = df['close'].rolling(window=N).min() == df['close']
    
    df['final_factor'] = df['factor_value'] + df['advance_decline'] + df['new_highs'] - df['new_lows']
    
    return df['final_factor']
```
