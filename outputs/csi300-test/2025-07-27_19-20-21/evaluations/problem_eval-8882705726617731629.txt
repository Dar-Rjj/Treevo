def heuristics_v2(df):
    # Calculate On-Balance Volume (OBV)
    obv = (df['close'].diff() > 0).astype(int) * df['volume'] - (df['close'].diff() < 0).astype(int) * df['volume']
    obv = obv.cumsum()
    
    # Calculate Typical Price
    tp = (df['high'] + df['low'] + df['close']) / 3
    
    # Calculate Mean Deviation
    md = (tp - tp.rolling(window=20).mean()).abs().rolling(window=20).mean()
    
    # Calculate Commodity Channel Index (CCI)
    cci = (tp - tp.rolling(window=20).mean()) / (0.015 * md)
    
    # Calculate %K and %D for Stochastic Oscillator
    lowest_low = df['low'].rolling(window=14).min()
    highest_high = df['high'].rolling(window=14).max()
    k = 100 * ((df['close'] - lowest_low) / (highest_high - lowest_low))
    d = k.rolling(window=3).mean()
    
    # Combine OBV, CCI, and %D into a single heuristic matrix
    heuristics_matrix = 0.4 * obv + 0.3 * cci + 0.3 * d
    
    return heuristics_matrix
