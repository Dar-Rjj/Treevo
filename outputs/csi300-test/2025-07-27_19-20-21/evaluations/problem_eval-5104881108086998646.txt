def heuristics_v3(df):
    # Calculate the weighted average of the closing prices over the last 20 days
    weighted_close = df['close'].rolling(window=20).apply(lambda x: (x * range(1, len(x) + 1)).sum() / (len(x) * (len(x) + 1) / 2))
    
    # Calculate the short and long period volumes
    vol_short = df['volume'].rolling(window=5).mean()
    vol_long = df['volume'].rolling(window=20).mean()
    
    # Combine the factors into a single heuristics matrix
    heuristics_matrix = (df['close'] / weighted_close) + (vol_short - vol_long)
    
    return heuristics_matrix
