```python
import pandas as pd

def heuristics_v2(df):
    # Calculate the simple price change
    df['price_change'] = df['close'] - df['close'].shift(1)
    
    # Calculate the 5-day moving average of close prices and subtract it from the current close price
    df['price_change_5ma'] = df['close'] - df['close'].rolling(window=5).mean()
    
    # Calculate the intraday range
    df['intraday_range'] = df['high'] - df['low']
    
    # Calculate the 14-day average true range
    df['true_range'] = df[['high' - 'low', 'high' - df['close'].shift(1), df['close'].shift(1) - 'low']].max(axis=1)
    df['atr_14'] = df['true_range'].rolling(window=14).mean()
    
    # Calculate the volume ratio
    df['volume_ratio'] = df['volume'] / df['volume'].rolling(window=20).mean()
    
    # Calculate the volume change
    df['volume_change'] = (df['volume'] - df['volume'].shift(1)) / df['volume'].shift(1)
    
    # Calculate the money flow
    df['typical_price'] = (df['high'] + df['low'] + df['close']) / 3
    df['money_flow'] = df['typical_price'] * df['volume']
    
    # Calculate the positive and negative money flow
    df['positive_money_flow'] = df[df['typical_price'] > df['typical_price'].shift(1)]['money_flow']
    df['negative_money_flow'] = df[df['typical_price'] < df['typical_price'].shift(1)]['money_flow']
    
    # Calculate the money flow index
    df['mfi_positive'] = df['positive_money_flow'].rolling(window=14).sum()
    df['mfi_negative'] = df['negative_money_flow'].rolling(window=14).abs().sum()
    df['mfi_ratio'] = df['mfi_positive'] / df['mfi_negative']
    df['mfi'] = 100 - (100 / (1 + df['mfi_ratio']))
    
    # Calculate the momentum factor
    df['sma_14'] = df['close'].rolling(window=14).mean()
    df['sma_50'] = df['close'].rolling(window=50).mean()
    df['momentum_factor'] = df['sma_14'] - df['sma_50']
    
    # Calculate the volatility
    df['daily_returns'] = df['close'].pct_change()
    df['volatility'] = df['daily_returns'].rolling(window=20).std()
    
    # Calculate the volume ratio
    df['volume_7_ma'] = df['volume'].rolling(window=7).mean()
    df['volume_21_ma'] = df['volume'].rolling(window=21).mean()
    df['volume_ratio_ma'] = df['volume_7_ma'] / df['volume_21_ma']
    
    # Calculate the relative strength
    df['rs_ema_14'] = df['close'].ewm(span=14, adjust=False).mean()
    df['rs_ema_200'] = df['close'].ewm(span=200, adjust=False).mean()
    df['relative_strength'] = df['rs_ema_14'] / df['rs_ema_200']
    
    # Calculate the market sentiment
    df['sentiment'] = (df['close'] - df['open']).cumsum().rolling(window=10).sum()
    
    # Calculate the advance-decline line
    df['adv_decline'] = (df['close'] > df['open']).astype(int) - (df['close'] < df['open']).astype(int)
    df['adv_decline_line'] = df['adv_decline'].rolling(window=20).sum()
    
    # Combine all factors with weights
    df['composite_factor'] = (
        0.2 * df['price_change'] +
        0.1 * df['price_change_5ma'] +
        0.1 * df['intraday_range'] +
        0.1 * df['atr_14'] +
        0.05 * df['volume_ratio'] +
        0.05 * df['volume_change'] +
        0.1 * df['mfi'] +
        0.1 * df['momentum_factor'] +
        0.1 * df['volatility'] +
        0.05 *
