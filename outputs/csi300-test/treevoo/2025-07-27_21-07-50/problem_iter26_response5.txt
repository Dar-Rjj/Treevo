```python
import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Momentum and Trend Analysis
    df['close_10_weighted'] = (df['close'].rolling(window=10).apply(lambda x: np.average(x, weights=np.arange(1, 11)), raw=False))
    df['roc_5_volume_adj'] = (df['close'] - df['close'].shift(5)) / df['close'].shift(5) * df['volume'] / df['volume'].rolling(window=5).mean()

    # Volume Anomaly and Surge Detection
    df['vol_30_ma'] = df['volume'].rolling(window=30).mean()
    df['vol_ratio_40_max'] = df['volume'] / df['volume'].rolling(window=40).max()

    # Price Volatility and Stability
    df['std_10_close'] = df['close'].rolling(window=10).std()
    df['atr_14'] = df[['high', 'low', 'close']].rolling(window=14).apply(lambda x: np.max(x['high']) - np.min(x['low']), raw=False)
    df['atr_14_ago'] = df['atr_14'].shift(14)

    # Reversal and Continuation Patterns
    df['bearish_engulfing'] = (df['close'] < df['open']) & (df['close'].shift(-1) > df['open'].shift(-1)) & (df['open'] > df['close'].shift(1)) & (df['close'] < df['open'].shift(1))
    df['bullish_engulfing'] = (df['close'] > df['open']) & (df['close'].shift(-1) < df['open'].shift(-1)) & (df['open'] < df['close'].shift(1)) & (df['close'] > df['open'].shift(1))
    df['hammer_hanging_man'] = (df['close'] - df['low']) / (df['high'] - df['low']) > 0.67 & (df['open'] - df['low']) / (df['high'] - df['low']) > 0.67
    df['engulfing_gap_confirmed'] = (df['bullish_engulfing'] | df['bearish_engulfing']) & (np.abs(df['open'].shift(-1) - df['close']) > 0.02 * df['close'])

    # Liquidity and Trading Activity
    df['volume_to_amount'] = df['volume'] / df['amount']
    df['volume_to_amount_20_ma'] = df['volume_to_amount'].rolling(window=20).mean()
    df['up_vol_down_vol_ratio'] = df[df['close'] > df['open']]['volume'] / df[df['close'] < df['open']]['volume']
    df['up_vol_down_vol_20_ma'] = df['up_vol_down_vol_ratio'].rolling(window=20).mean()

    # Intraday Volatility
    df['high_low_spread'] = df['high'] - df['low']
    df['open_close_spread'] = df['close'] - df['open']
    df['intraday_volatility'] = (df['high_low_spread'] + df['open_close_spread']) * df['volume']

    # Volume Adjusted Momentum (VAMI)
    df['daily_price_change'] = df['close'] - df['open']
    df['volume_adjusted_price_change'] = df['daily_price_change'] * df['volume']
    df['vami'] = df['volume_adjusted_price_change'] / df['volume'].rolling(window=20).mean()

    # Volume-Weighted Close
    df['volume_weighted_close'] = df['close'] * df['volume']

    # Simple Moving Average (SMA) of Volume-Weighted Close (21 Days)
    df['sma_21_vwc'] = df['volume_weighted_close'].rolling(window=21).mean()

    # Short-Term Reversal
    df['past_5_day_returns'] = df['close'].pct_change().rolling(window=5).sum()

    # Composite Alpha Factor
    df['composite_alpha_factor'] = (df['volume_weighted_close'] - df['sma_21_vwc']) + df['vami'] + df['past_5_day_returns'] + df['intraday_volatility']

    return df['composite_alpha_factor']
```
