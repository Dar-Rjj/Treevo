```python
import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Momentum and Trend Analysis
    df['weighted_close'] = df['close'].rolling(window=10).apply(lambda x: np.average(x, weights=np.arange(1, len(x)+1)), raw=False)
    df['volume_adj_roc'] = (df['close'] - df['close'].shift(5)) / df['close'].shift(5) * df['volume'] / df['volume'].shift(5)
    df['cumsum_returns_20'] = df['close'].pct_change().rolling(window=20).sum()
    df['smoothed_cumsum_returns_20'] = df['cumsum_returns_20'].rolling(window=5).mean()

    # Volume Anomaly and Surge Detection
    df['vol_change'] = (df['volume'] - df['volume'].rolling(window=30).mean()) / df['volume'].rolling(window=30).std()
    df['vol_ratio_40_max'] = df['volume'] / df['volume'].rolling(window=40).max()

    # Price Volatility and Stability
    df['recent_volatility'] = df['close'].rolling(window=10).std()
    df['atr_14'] = df[['high', 'low', 'close']].rolling(window=14).apply(lambda x: np.max(x[0:2]) - np.min(x[0:2]), raw=True)
    df['atr_compare_14'] = df['atr_14'] / df['atr_14'].shift(14)
    df['hh_ll_ratio_20'] = (df['high'].rolling(window=20).max() - df['low'].rolling(window=20).min()) / df['close']
    df['hh_ll_ratio_10'] = (df['high'].rolling(window=10).max() - df['low'].rolling(window=10).min()) / df['close']

    # Reversal and Continuation Patterns
    df['engulfing_bullish'] = ((df['open'] > df['close'].shift(1)) & (df['close'] > df['open']) & (df['close'] > df['high'].shift(1)) & (df['open'] < df['low'].shift(1)))
    df['engulfing_bearish'] = ((df['open'] < df['close'].shift(1)) & (df['close'] < df['open']) & (df['close'] < df['low'].shift(1)) & (df['open'] > df['high'].shift(1)))
    df['gap_confirmation'] = (df['close'] > df['close'].shift(1) + 0.01 * df['close'].shift(1)) | (df['close'] < df['close'].shift(1) - 0.01 * df['close'].shift(1))
    
    df['hammer_hanging_man'] = ((df['close'] - df['low']) / (df['high'] - df['low']) > 0.67) & ((df['close'] - df['open']) / (df['high'] - df['low']) < 0.33)
    df['harami_bullish'] = (df['open'] > df['close']) & (df['open'].shift(-1) < df['close'].shift(-1)) & (df['open'] < df['close'].shift(-1)) & (df['close'] > df['open'].shift(-1))
    df['harami_bearish'] = (df['open'] < df['close']) & (df['open'].shift(-1) > df['close'].shift(-1)) & (df['open'] > df['close'].shift(-1)) & (df['close'] < df['open'].shift(-1))

    # Liquidity and Trading Activity
    df['vol_amount_ratio'] = df['volume'] / df['amount']
    df['vol_amount_ratio_ma_20'] = df['vol_amount_ratio'].rolling(window=20).mean()
    df['up_down_vol_ratio'] = df['volume'].where(df['close'] > df['close'].shift(1)).fillna(0) / df['volume'].where(df['close'] < df['close'].shift(1)).fillna(0)
    df['up_down_vol_ratio_ma_20'] = df['up_down_vol_ratio'].rolling(window=20).mean()

    # Combine all factors into a single alpha factor
    df['alpha_factor'] = (
        df['weighted_close'] +
        df['volume_adj_roc'] +
        df['smoothed_cum
