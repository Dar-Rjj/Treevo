```python
import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Momentum and Trend Analysis
    df['weighted_close'] = df['close'].rolling(window=10).apply(lambda x: np.average(x, weights=np.arange(1, 11)), raw=False)
    df['roc_5'] = (df['close'] - df['close'].shift(5)) / df['volume']
    df['return_10'] = df['close'].pct_change(10)
    df['return_20'] = df['close'].pct_change(20)
    df['return_50'] = df['close'].pct_change(50)
    df['momentum_score'] = 0.5 * df['return_10'] + 0.3 * df['return_20'] + 0.2 * df['return_50']

    # Volume Anomaly and Surge Detection
    df['vol_30ma'] = df['volume'].rolling(window=30).mean()
    df['vol_ratio_long_term'] = df['volume'] / df['volume'].rolling(window=40).max()
    df['avg_vol_10'] = df['volume'].rolling(window=10).mean()
    df['price_change'] = df['close'].pct_change()
    df['price_vol_indicator'] = df['price_change'] * (df['volume'] / df['avg_vol_10'])

    # Price Volatility and Stability
    df['std_10'] = df['close'].rolling(window=10).std()
    df['atr_14'] = df[['high', 'low', 'close']].rolling(window=14).apply(lambda x: np.max(x) - np.min(x), raw=True)
    df['log_returns'] = np.log(df['close']).diff()
    df['vol_factor'] = df['log_returns'].rolling(window=30).std()

    # Reversal and Continuation Patterns
    df['engulfing_bullish'] = ((df['open'] > df['close'].shift(1)) & (df['close'] > df['open'].shift(1)) & (df['close'] > df['open'].shift(1)) & (df['close'].shift(1) > df['open'].shift(1)))
    df['engulfing_bearish'] = ((df['open'] < df['close'].shift(1)) & (df['close'] < df['open'].shift(1)) & (df['close'].shift(1) < df['open'].shift(1)) & (df['close'] < df['open']))
    df['hammer'] = ((df['close'] - df['low']) / (df['high'] - df['low']) > 0.66) & ((df['high'] - df['close']) / (df['high'] - df['low']) < 0.33)
    df['hanging_man'] = ((df['close'] - df['low']) / (df['high'] - df['low']) > 0.66) & ((df['high'] - df['close']) / (df['high'] - df['low']) < 0.33)

    # Liquidity and Trading Activity
    df['vol_amount_ratio'] = df['volume'] / df['amount']
    df['vol_amount_ratio_20ma'] = df['vol_amount_ratio'].rolling(window=20).mean()
    df['vol_up_down_ratio'] = df['volume'][df['close'] > df['close'].shift(1)].fillna(0) / df['volume'][df['close'] < df['close'].shift(1)].fillna(0)
    df['vol_up_down_ratio_20ma'] = df['vol_up_down_ratio'].rolling(window=20).mean()

    # Relative Strength Index (RSI)
    delta = df['close'].diff()
    gain = (delta.where(delta > 0, 0)).rolling(window=14).mean()
    loss = (-delta.where(delta < 0, 0)).rolling(window=14).mean()
    rs = gain / loss
    df['rsi'] = 100 - (100 / (1 + rs))

    # Money Flow Index (MFI)
    typical_price = (df['high'] + df['low'] + df['close']) / 3
    raw_money_flow = typical_price * df['volume']
    positive_money_flow = raw_money_flow.where(typical_price > typical_price.shift(1), 0).rolling(window=14).sum()
    negative_money_flow = raw_money_flow.where(typical_price < typical_price.shift(1), 
