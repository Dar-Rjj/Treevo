```python
import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Compute basic price and volume patterns
    df['daily_price_range'] = df['high'] - df['low']
    df['daily_return_close_to_close'] = (df['close'].shift(-1) - df['close']) / df['close']
    df['daily_return_open_to_close'] = (df['close'] - df['open']) / df['open']
    df['avg_volume_5_days'] = df['volume'].rolling(window=5).mean()
    
    # Compute price-volume relationships
    df['volume_to_price_ratio'] = df['volume'] / df['close']
    df['avg_volume_to_price_ratio_5_days'] = df['volume_to_price_ratio'].rolling(window=5).mean()
    
    # Compute intraday momentum
    df['intraday_momentum'] = df['close'] - df['open']
    df['intraday_momentum_reversal'] = df['intraday_momentum'].apply(lambda x: -x if x > 0 else x)
    df['avg_intraday_momentum_5_days'] = df['intraday_momentum'].rolling(window=5).mean()
    
    # Compute price gaps
    df['price_gap'] = df['open'].shift(-1) - df['close']
    df['avg_price_gap_5_days'] = df['price_gap'].rolling(window=5).mean()
    
    # Compute technical indicators
    def rsi(series, period=14):
        delta = series.diff(1)
        gain = (delta.where(delta > 0, 0)).rolling(window=period).mean()
        loss = (-delta.where(delta < 0, 0)).rolling(window=period).mean()
        rs = gain / loss
        return 100 - (100 / (1 + rs))

    df['rsi_14'] = rsi(df['close'], 14)
    
    def macd(series, fast=12, slow=26, signal=9):
        ema_fast = series.ewm(span=fast, adjust=False).mean()
        ema_slow = series.ewm(span=slow, adjust=False).mean()
        macd_line = ema_fast - ema_slow
        signal_line = macd_line.ewm(span=signal, adjust=False).mean()
        return macd_line, signal_line, macd_line - signal_line
    
    macd_line, signal_line, macd_hist = macd(df['close'])
    df['macd_line'] = macd_line
    df['signal_line'] = signal_line
    df['macd_histogram'] = macd_hist
    
    df['roc_14'] = df['close'].pct_change(periods=14)
    
    # Compute volatility measures
    df['std_dev_20_days'] = df['close'].rolling(window=20).std()
    
    def true_range(high, low, close_prev):
        tr = pd.Series(index=high.index)
        tr[0] = high[0] - low[0]
        for i in range(1, len(tr)):
            tr[i] = max(high[i] - low[i], high[i] - close_prev[i-1], close_prev[i-1] - low[i])
        return tr
    
    tr = true_range(df['high'], df['low'], df['close'].shift(1))
    df['atr_14'] = tr.rolling(window=14).mean()
    
    # Compute trend following
    df['sma_50'] = df['close'].rolling(window=50).mean()
    df['ema_50'] = df['close'].ewm(span=50, adjust=False).mean()
    
    # Create a composite factor
    weights = {
        'daily_price_range': 0.1,
        'daily_return_close_to_close': 0.2,
        'daily_return_open_to_close': 0.1,
        'avg_volume_5_days': 0.1,
        'volume_to_price_ratio': 0.1,
        'avg_volume_to_price_ratio_5_days': 0.1,
        'intraday_momentum': 0.1,
        'intraday_momentum_reversal': 0.1,
        'avg_intraday_momentum_5_days': 0.1,
        'price_gap': 0.1,
        'avg_price_gap_5_days': 0.1,
        'rsi_14': 0.1,
        'macd_histogram': 0.1,
        'roc_14': 0.1,
        'std_dev_20_days': 0.
