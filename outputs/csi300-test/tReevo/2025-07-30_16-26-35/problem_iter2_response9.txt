```python
import pandas as pd
import numpy as np

def heuristics_v2(df, n_days=20, lookback_period=5):
    # Calculate Daily Range
    df['daily_range'] = df['high'] - df['low']
    
    # Calculate Upper and Lower Breakout Levels
    df['midpoint'] = (df['high'] + df['low']) / 2
    df['upper_breakout'] = df['high'] + df['daily_range'] * 0.1
    df['lower_breakout'] = df['low'] - df['daily_range'] * 0.1
    
    # Determine if Close is Above or Below Midpoint
    df['is_above_midpoint'] = df['close'] > df['midpoint']
    
    # Calculate Distance to Breakout Levels
    df['distance_to_upper'] = df['upper_breakout'] - df['close']
    df['distance_to_lower'] = df['close'] - df['lower_breakout']
    
    # Incorporate Volatility
    df['volatility'] = df['close'].rolling(window=n_days).std()
    df['adj_distance_to_upper'] = df['distance_to_upper'] / df['volatility']
    df['adj_distance_to_lower'] = df['distance_to_lower'] / df['volatility']
    
    # Assign Weight Based on Volume and Market Cap
    df['weighted_distance'] = (
        df['volume'] * 
        df['market_cap'] * 
        df[['adj_distance_to_upper', 'adj_distance_to_lower']].max(axis=1)
    )
    
    # Calculate Final Alpha Factor
    df['alpha_factor'] = df['weighted_distance'].rolling(window=lookback_period).sum()
    
    return df['alpha_factor']

# Example usage:
# df = pd.DataFrame({
#     'date': pd.date_range(start='2023-01-01', periods=100),
#     'open': np.random.rand(100) * 100,
#     'high': np.random.rand(100) * 100,
#     'low': np.random.rand(100) * 100,
#     'close': np.random.rand(100) * 100,
#     'amount': np.random.randint(1000, 5000, size=100),
#     'volume': np.random.randint(1000, 5000, size=100),
#     'market_cap': np.random.randint(1_000_000, 10_000_000, size=100)
# })
# df.set_index('date', inplace=True)
# alpha_factor = heuristics_v2(df)
# print(alpha_factor)
```
