```txt
Price Momentum Adjusted by Volume and Price Spikes with Enhanced Spike Detection
├── Calculate Daily Log Return
│   ├── Use Close price
│   └── Compute log of current close / previous day close
├── Identify Volume and Price Spikes
│   ├── Detect Volume Spikes
│   │   ├── Calculate Z-Score of Volume
│   │   │   ├── Use Volume
│   │   │   └── Calculate Rolling Mean and Standard Deviation
│   │   └── Classify as Volume Spike if Z-Score exceeds a threshold
│   ├── Detect Price Spikes
│   │   ├── Calculate Range (High - Low)
│   │   └── Classify as Price Spike if Range exceeds a moving average
│   └── Classify as Spike if either Volume or Price Spike is detected
├── Adjust Momentum for Volume and Price Spikes
│   ├── If Spike, apply a weight to the daily log return
│   └── If not, use original daily log return
├── Smooth the Adjusted Returns
│   ├── Use Exponential Moving Average
│   └── Select an appropriate span
└── Cumulative Momentum Factor
    ├── Sum Up Adjusted and Smoothed Returns
    └── Set initial value to 1
        └── Add 1 to each daily return before multiplication
```
