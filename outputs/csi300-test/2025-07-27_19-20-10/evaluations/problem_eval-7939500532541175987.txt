import pandas as pd

def heuristics_v2(df):
    def calculate_close_ma_ratio(df, window=20):
        close_ma = df['close'].rolling(window=window).mean()
        return df['close'] / close_ma
    
    def calculate_volume_ma_ratio(df, window=20):
        volume_ma = df['volume'].rolling(window=window).mean()
        return df['volume'] / volume_ma
    
    def calculate_atr(df, window=14):
        high_low = df['high'] - df['low']
        high_close = (df['high'] - df['close'].shift()).abs()
        low_close = (df['low'] - df['close'].shift()).abs()
        ranges = pd.concat([high_low, high_close, low_close], axis=1).max(axis=1)
        return ranges.rolling(window=window).mean()
    
    close_ma_ratio = calculate_close_ma_ratio(df)
    volume_ma_ratio = calculate_volume_ma_ratio(df)
    atr = calculate_atr(df)
    
    # Calculate the heuristic score
    heuristic_score = (close_ma_ratio * volume_ma_ratio) / (1 + atr)
    
    heuristics_matrix = pd.Series(heuristic_score, index=df.index, name='Alpha Factor')
    return heuristics_matrix
