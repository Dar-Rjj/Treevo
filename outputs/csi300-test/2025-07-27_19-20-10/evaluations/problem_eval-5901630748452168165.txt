import pandas as pd

def heuristics_v2(df):
    # Calculate True Range
    df['high_low'] = df['high'] - df['low']
    df['high_close_prev'] = abs(df['high'] - df['close'].shift(1))
    df['low_close_prev'] = abs(df['low'] - df['close'].shift(1))
    df['true_range'] = df[['high_low', 'high_close_prev', 'low_close_prev']].max(axis=1)
    
    # Calculate +DM and -DM
    df['up_move'] = df['high'].diff()
    df['down_move'] = df['low'].diff().abs()
    df['+dm'] = np.where((df['up_move'] > df['down_move']) & (df['up_move'] > 0), df['up_move'], 0)
    df['-dm'] = np.where((df['down_move'] > df['up_move']) & (df['down_move'] > 0), df['down_move'], 0)
    
    # Calculate DMI
    df['+di'] = 100 * (df['+dm'].rolling(window=14).sum() / df['true_range'].rolling(window=14).sum())
    df['-di'] = 100 * (df['-dm'].rolling(window=14).sum() / df['true_range'].rolling(window=14).sum())
    dmi = df['+di'] - df['-di']
    
    # Calculate Chaikin Money Flow
    money_flow_multiplier = ((df['close'] - df['low']) - (df['high'] - df['close'])) / (df['high'] - df['low'])
    money_flow_volume = money_flow_multiplier * df['volume']
    cmf = money_flow_volume.rolling(window=14).sum() / df['volume'].rolling(window=14).sum()
    
    # Heuristic factor
    heuristics_matrix = dmi * cmf
    
    return heuristics_matrix
