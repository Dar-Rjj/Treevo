import pandas as pd

def heuristics_v2(df):
    lookback_period = 20
    price_change = df['close'].pct_change(lookback_period).ewm(span=lookback_period, adjust=False).mean()
    volume_change = df['volume'].pct_change(lookback_period).ewm(span=lookback_period, adjust=False).mean()
    amount_change = df['amount'].pct_change(lookback_period).ewm(span=lookback_period, adjust=False).mean()
    
    # Calculate recent volatility to use as dynamic weights
    price_volatility = df['close'].rolling(window=lookback_period).std()
    volume_volatility = df['volume'].rolling(window=lookback_period).std()
    amount_volatility = df['amount'].rolling(window=lookback_period).std()
    
    # Inverting the volatility for weight calculation, adding 1e-6 to avoid division by zero
    w_price = 1 / (price_volatility + 1e-6)
    w_volume = 1 / (volume_volatility + 1e-6)
    w_amount = 1 / (amount_volatility + 1e-6)
    
    # Calculate the heuristic factor
    heuristics_matrix = w_price * price_change + w_volume * volume_change + w_amount * amount_change
    return heuristics_matrix
