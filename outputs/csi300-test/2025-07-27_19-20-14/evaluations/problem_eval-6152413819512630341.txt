def heuristics_v2(df):
    df['SMA_20'] = df['close'].rolling(window=20).mean()
    df['std_20'] = df['close'].rolling(window=20).std()
    df['upper_band'] = df['SMA_20'] + 2 * df['std_20']
    df['lower_band'] = df['SMA_20'] - 2 * df['std_20']
    df['%K'] = (df['close'] - df['low'].rolling(window=14).min()) / (df['high'].rolling(window=14).max() - df['low'].rolling(window=14).min())
    df['%D'] = df['%K'].rolling(window=3).mean()
    df['RSI'] = 100 - (100 / (1 + (df['close'].diff().where(df['close'].diff() > 0, 0).rolling(window=14).mean() / -df['close'].diff().where(df['close'].diff() < 0, 0).rolling(window=14).mean()))
    df['BB_factor'] = (df['close'] - df['lower_band']) / (df['upper_band'] - df['lower_band'])
    heuristics_matrix = (df['BB_factor'] + df['RSI']) / 2
    return heuristics_matrix
