def heuristics_v2(df):
    df['log_return_close'] = np.log(df['close'] / df['close'].shift(1))
    df['median_price'] = (df['high'] + df['low']) / 2
    df['log_return_median'] = np.log(df['median_price'] / df['median_price'].shift(1))
    df['avg_volume_30'] = df['volume'].rolling(window=30).mean()
    df['volume_ratio'] = df['volume'] / df['avg_volume_30']
    heuristics_matrix = (df['log_return_close'] - df['log_return_median']) * df['volume_ratio'].fillna(0)
    return heuristics_matrix
