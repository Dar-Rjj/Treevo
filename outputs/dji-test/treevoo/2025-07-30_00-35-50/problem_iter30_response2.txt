```python
import pandas as pd

def heuristics_v2(df):
    # Calculate the difference between today's close and yesterday's close
    df['price_diff'] = df['close'] - df['close'].shift(1)
    
    # Exponential moving average of the price difference over 10 days
    df['ema_10_price_diff'] = df['price_diff'].ewm(span=10, min_periods=10).mean()
    df['diff_ema_10'] = df['price_diff'] - df['ema_10_price_diff']
    
    # Simple moving average of the price difference over 20 days
    df['sma_20_price_diff'] = df['price_diff'].rolling(window=20, min_periods=20).mean()
    df['diff_sma_20'] = df['price_diff'] - df['sma_20_price_diff']
    
    # Calculate the ratio of today's close to yesterday's close
    df['daily_return_ratio'] = df['close'] / df['close'].shift(1)
    
    # Exponential moving average of the daily return ratio over 5 days
    df['ema_5_daily_return'] = df['daily_return_ratio'].ewm(span=5, min_periods=5).mean()
    df['dev_ema_5'] = df['daily_return_ratio'] - df['ema_5_daily_return']
    
    # Standard deviation of the daily return ratio over the last 30 trading days
    df['std_30_daily_return'] = df['daily_return_ratio'].rolling(window=30, min_periods=30).std()
    df['normalized_dev_30'] = df['dev_ema_5'].abs() / df['std_30_daily_return']
    
    # Determine the range (high - low) of the day
    df['daily_range'] = df['high'] - df['low']
    
    # Average daily range over the last 7 days
    df['avg_range_7'] = df['daily_range'].rolling(window=7, min_periods=7).mean()
    df['change_avg_range_7'] = df['daily_range'] - df['avg_range_7']
    
    # Find the highest high and lowest low over the past 14 days
    df['highest_high_14'] = df['high'].rolling(window=14, min_periods=14).max()
    df['lowest_low_14'] = df['low'].rolling(window=14, min_periods=14).min()
    df['position_in_envelope'] = (df['close'] - df['lowest_low_14']) / (df['highest_high_14'] - df['lowest_low_14'])
    
    # Consider the volume traded on the current day
    df['volume_10_ma'] = df['volume'].rolling(window=10, min_periods=10).mean()
    df['volume_above_10_ma'] = (df['volume'] > df['volume_10_ma']).astype(int)
    
    # Calculate the ratio of today's volume to the 20-day average volume
    df['volume_20_ma'] = df['volume'].rolling(window=20, min_periods=20).mean()
    df['volume_ratio_20'] = df['volume'] / df['volume_20_ma']
    df['volume_category'] = pd.qcut(df['volume_ratio_20'], q=[0, 0.33, 0.66, 1], labels=['low', 'medium', 'high'])
    
    # Analyze the relationship between the amount (dollar value) and the volume
    df['daily_avg_price'] = (df['high'] + df['low'] + df['close']) / 3
    df['dollar_value'] = df['daily_avg_price'] * df['volume']
    df['dollar_value_50_ma'] = df['dollar_value'].rolling(window=50, min_periods=50).mean()
    df['dollar_value_signal'] = (df['dollar_value'] > df['dollar_value_50_ma']).astype(int)
    
    # Combine all the sub-thoughts into a final factor
    factor = (
        df['diff_ema_10'] + 
        df['diff_sma_20'] + 
        df['normalized_dev_30'] + 
        df['change_avg_range_7'] + 
        df['position_in_envelope'] + 
        df['volume_above_10_ma'] + 
        df['dollar_value_signal']
    )
    
    return factor.dropna()
```
