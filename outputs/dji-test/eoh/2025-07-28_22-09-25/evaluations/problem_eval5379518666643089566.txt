import pandas as pd

def heuristics_v2(df):
    def average_true_range(high, low, close, n=14):
        tr = pd.Series(index=high.index)
        for i in range(len(tr)):
            if i == 0:
                tr[i] = high.iloc[i] - low.iloc[i]
            else:
                hl = high.iloc[i] - low.iloc[i]
                hpc = abs(high.iloc[i] - close.iloc[i-1])
                lpc = abs(low.iloc[i] - close.iloc[i-1])
                tr[i] = max(hl, hpc, lpc)
        
        atr = tr.rolling(window=n).mean()
        return atr
    
    atr = average_true_range(df['high'], df['low'], df['close'])
    atr_vol_ratio = atr / df['volume']
    heuristics_matrix = atr_vol_ratio.rolling(window=20).median().dropna()
    
    return heuristics_matrix
