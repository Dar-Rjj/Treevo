import pandas as pd
import numpy as np

def heuristics_v2(df):
    def rsi(series, periods=14):
        delta = series.diff()
        up, down = delta.copy(), delta.copy()
        up[up < 0] = 0
        down[down > 0] = 0
        roll_up = up.ewm(com=periods - 1, adjust=False).mean()
        roll_down = down.abs().ewm(com=periods - 1, adjust=False).mean()
        rs = roll_up / roll_down
        return 100.0 - (100.0 / (1.0 + rs))

    df['Close_5EMA'] = df['close'].ewm(span=5, adjust=False).mean()
    df['Close_20EMA'] = df['close'].ewm(span=20, adjust=False).mean()
    df['RSI'] = rsi(df['close'])
    df['Volume_Change'] = df['volume'].pct_change()
    
    heuristics_matrix = (df['RSI'] * 0.4 + (df['Close_5EMA'] - df['Close_20EMA']) * 0.3 + df['Volume_Change'] * 0.3)
    return heuristics_matrix
