import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Calculate daily returns
    df['daily_return'] = df['close'].pct_change()
    
    # Calculate daily volatility (standard deviation of daily returns over a rolling window)
    df['volatility'] = df['daily_return'].rolling(window=20).std()
    
    # Calculate the weighted moving average of volume, giving more weight to recent days
    weights = np.arange(1, 21)  # Weights for the last 20 days
    df['wma_volume'] = df['volume'].rolling(window=20).apply(lambda x: np.sum(weights * x) / np.sum(weights), raw=True)
    
    # Create the heuristic factor by combining volatility and wma_volume
    df['heuristics_factor'] = (df['volatility'] / df['wma_volume']) * 100  # Scale for interpretability
    
    heuristics_matrix = df['heuristics_factor']
    
    return heuristics_matrix
