import pandas as pd
from sklearn.decomposition import PCA

def heuristics_v2(df):
    # Calculate simple return for momentum
    returns = df['close'].pct_change()
    
    # Calculate volatility (standard deviation of returns)
    volatility = returns.rolling(window=20).std()
    
    # Calculate liquidity (volume divided by close price)
    liquidity = df['volume'] / df['close']
    
    # Combine factors into a DataFrame
    factors_df = pd.DataFrame({
        'returns': returns,
        'volatility': volatility,
        'liquidity': liquidity
    }).dropna()
    
    # Apply PCA to combine factors
    pca = PCA(n_components=1)
    heuristics_matrix = pca.fit_transform(factors_df)
    
    # Convert to pandas Series
    heuristics_matrix = pd.Series(heuristics_matrix.flatten(), index=factors_df.index)
    
    return heuristics_matrix
