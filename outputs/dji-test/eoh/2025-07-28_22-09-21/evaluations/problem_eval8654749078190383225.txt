import pandas as pd

def heuristics_v2(df):
    # Calculate the return from the close price
    returns = df['close'].pct_change()
    # Calculate the short-term and long-term exponential moving average of returns
    ema_10d_returns = returns.ewm(span=10, adjust=False).mean()
    ema_30d_returns = returns.ewm(span=30, adjust=False).mean()
    # Calculate the Average True Range (ATR) as a measure of volatility
    tr = pd.DataFrame({'H-L':df['high']-df['low'],'H-PDC':abs(df['high']-df['close'].shift(1)),'L-PDC':abs(df['low']-df['close'].shift(1))}).max(axis=1)
    atr = tr.rolling(window=14).mean()
    # Calculate the 20-day moving average of volume
    vol_20d_ma = df['volume'].rolling(window=20).mean()
    # Generate the heuristics matrix
    heuristics_matrix = ema_10d_returns - ema_30d_returns + atr / (vol_20d_ma / df['volume'])
    return heuristics_matrix
