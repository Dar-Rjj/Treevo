import pandas as pd
import numpy as np

def heuristics_v2(df):
    def vw_price(close, volume):
        return (close * volume).cumsum() / volume.cumsum()

    def variance(series, periods=20):
        return series.rolling(window=periods).var()

    vw_close = vw_price(df['close'], df['volume'])
    close_var = variance(vw_close)
    combined_factor = (vw_close + close_var).rename('combined_factor')
    heuristics_matrix = combined_factor.ewm(span=60, adjust=False).mean().rename('heuristic_factor')

    return heuristics_matrix
