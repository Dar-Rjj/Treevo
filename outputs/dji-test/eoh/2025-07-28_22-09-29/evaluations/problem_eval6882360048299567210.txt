import pandas as pd

def wma(series, window=5):
    weights = pd.Series(range(1,window+1))
    wma = series.rolling(window=window).apply(lambda prices: (prices * weights).sum() / weights.sum(), raw=True)
    return wma

def heuristics_v2(df):
    def momentum(price, periods=14):
        return (price - price.shift(periods))/price.shift(periods)

    def sma(volume, fast=7, slow=21):
        ema_fast = volume.rolling(window=fast).mean()
        ema_slow = volume.rolling(window=slow).mean()
        return ema_fast - ema_slow
    
    close_momentum = momentum(df['close'])
    volume_sma_diff = sma(df['volume'])
    combined_factor = (close_momentum + volume_sma_diff).rename('combined_factor')
    heuristics_matrix = wma(combined_factor, window=10).rename('heuristic_factor')

    return heuristics_matrix
