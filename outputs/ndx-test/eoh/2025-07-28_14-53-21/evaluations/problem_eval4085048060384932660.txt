import pandas as pd

def heuristics_v2(df):
    def average_true_range(high, low, close, window=14):
        tr = pd.Series(0.0, index=high.index)
        for i in range(1, len(close)):
            hl = high[i] - low[i]
            hpc = abs(high[i] - close[i-1])
            lpc = abs(low[i] - close[i-1])
            tr[i] = max(hl, hpc, lpc)
        atr = tr.rolling(window=window).mean()
        return atr

    def directional_movement(high, low, window=14):
        up_move = high.diff()
        down_move = low.diff().abs()
        pos_dm = pd.Series(0.0, index=up_move.index)
        neg_dm = pd.Series(0.0, index=down_move.index)
        
        for i in range(1, len(up_move)):
            if up_move[i] > down_move[i] and up_move[i] > 0:
                pos_dm[i] = up_move[i]
            else:
                pos_dm[i] = 0
            if down_move[i] > up_move[i] and down_move[i] > 0:
                neg_dm[i] = down_move[i]
            else:
                neg_dm[i] = 0
                
        di_pos = 100 * (pos_dm.rolling(window=window).sum() / average_true_range(high, low, close, window))
        di_neg = 100 * (neg_dm.rolling(window=window).sum() / average_true_range(high, low, close, window))
        return di_pos, di_neg

    high = df['high']
    low = df['low']
    close = df['close']

    atr = average_true_range(high, low, close)
    di_pos, di_neg = directional_movement(high, low)

    heuristics_matrix = 0.5 * (di_pos - di_neg) + 0.5 * atr
    return heuristics_matrix
