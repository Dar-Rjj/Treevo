import pandas as pd

def heuristics_v2(df):
    wma_20 = df['close'].rolling(window=20).apply(lambda x: (x * pd.Series(range(1, 21))).sum() / 210, raw=True)
    wma_60 = df['close'].rolling(window=60).apply(lambda x: (x * pd.Series(range(1, 61))).sum() / 1830, raw=True)
    wma_crossover = wma_20 - wma_60
    
    tr = df[['high', 'low', 'close']].join(df[['high', 'low', 'close']].shift(1)).drop(columns=['high', 'low']).rename(columns={'high_x': 'high', 'low_x': 'low', 'close_x': 'close'}).assign(TR=lambda x: x.apply(lambda y: max(y['high'] - y['low'], abs(y['high'] - y['close_y']), abs(y['low'] - y['close_y'])), axis=1))['TR']
    
    atr_14 = tr.rolling(window=14).mean()
    atr_28 = tr.rolling(window=28).mean()
    atr_diff = atr_14 - atr_28
    
    heuristics_matrix = (wma_crossover + atr_diff) / 2
    return heuristics_matrix
