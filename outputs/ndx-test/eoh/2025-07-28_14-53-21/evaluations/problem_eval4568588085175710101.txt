def heuristics_v2(df):
    # Calculate Rate of Change (ROC)
    roc = df['close'].pct_change(periods=21)

    # Calculate Average Directional Index (ADX)
    def adx(high, low, close, lookback):
        plus_dm = high.diff()
        minus_dm = low.diff()
        plus_dm[plus_dm < 0] = 0
        minus_dm[minus_dm > 0] = 0
        tr = pd.DataFrame({'tr1': abs(high - low), 'tr2': abs(high - close.shift(1)), 'tr3': abs(low - close.shift(1))})
        tr['tr'] = tr.max(axis=1)
        atr = tr['tr'].rolling(window=lookback).mean()
        
        plus_di = 100 * (plus_dm.rolling(window=lookback).sum() / atr)
        minus_di = abs(100 * (minus_dm.rolling(window=lookback).sum() / atr))
        dx = (abs(plus_di - minus_di) / (plus_di + minus_di)) * 100
        return dx.rolling(window=lookback).mean()

    adx_values = adx(df['high'], df['low'], df['close'], 14)

    # Calculate High to Low ratio
    hl_ratio = df['high'] / df['low']

    # Combine ROC, ADX, and HL Ratio into a single heuristic factor
    heuristics_matrix = roc + adx_values - hl_ratio

    return heuristics_matrix
