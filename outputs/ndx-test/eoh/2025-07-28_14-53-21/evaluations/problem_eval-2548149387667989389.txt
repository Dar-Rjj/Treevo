def heuristics_v2(df):
    # Calculate MACD
    ema12 = df['close'].ewm(span=12, adjust=False).mean()
    ema26 = df['close'].ewm(span=26, adjust=False).mean()
    macd_line = ema12 - ema26
    signal_line = macd_line.ewm(span=9, adjust=False).mean()
    macd_signal_diff = macd_line - signal_line

    # Calculate ADX
    tr = pd.DataFrame({'h-l': df['high'] - df['low'], 'h-pc': abs(df['high'] - df['close'].shift()), 'l-pc': abs(df['low'] - df['close'].shift())})
    tr['tr'] = tr.max(axis=1)
    atr = tr['tr'].rolling(window=14).mean()
    
    plus_dm = df['high'].diff()
    minus_dm = -df['low'].diff()
    plus_dm[plus_dm < 0] = 0
    minus_dm[minus_dm < 0] = 0
    
    plus_di = 100 * (plus_dm.rolling(window=14).sum() / atr)
    minus_di = 100 * (minus_dm.rolling(window=14).sum() / atr)
    dx = 100 * (abs(plus_di - minus_di) / (plus_di + minus_di))
    adx = dx.rolling(window=14).mean()

    # Dynamic weight allocation based on the strength of the trend
    weight_macd = adx / (adx + 100)
    weight_adx = 1 - weight_macd
    heuristics_matrix = weight_macd * macd_signal_diff + weight_adx * adx

    return heuristics_matrix
