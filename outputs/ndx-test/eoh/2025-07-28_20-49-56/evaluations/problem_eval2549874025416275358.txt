import pandas as pd
import numpy as np
from sklearn.linear_model import LinearRegression

def heuristics_v2(df):
    # Calculate log returns
    log_returns = np.log(df['close']).diff()
    
    # Fit a linear regression on 60-day log returns and get the slope
    def calc_slope(x):
        model = LinearRegression().fit(np.arange(len(x)).reshape(-1, 1), x)
        return model.coef_[0]
    slopes = log_returns.rolling(window=60).apply(calc_slope, raw=False)
    
    # Calculate On-Balance Volume (OBV)
    obv = (np.sign(df['close'].diff()) * df['volume']).cumsum()
    
    # Calculate the 20-day rate of change in OBV
    obv_roc = (obv - obv.shift(20)) / obv.shift(20)
    
    # Combine the slope and OBV ROC into a single heuristics measure
    heuristics_matrix = (slopes + obv_roc) / 2
    
    return heuristics_matrix
