import pandas as pd

def heuristics_v2(df):
    def momentum(df, n=14):
        return df['close'].pct_change(n)

    def rsi(df, n=14):
        delta = df['close'].diff(1)
        gain = (delta.where(delta > 0, 0)).rolling(window=n).mean()
        loss = (-delta.where(delta < 0, 0)).rolling(window=n).mean()
        rs = gain / loss
        return 100 - (100 / (1 + rs))

    def volatility(df, n=14):
        return df['close'].pct_change().rolling(window=n).std()

    def weight_adjustment(factor, n=14):
        return factor.rolling(window=n).corr(df['close']).fillna(0)

    df['momentum'] = momentum(df)
    df['rsi'] = rsi(df)
    df['volatility'] = volatility(df)

    df['momentum_weight'] = weight_adjustment(df['momentum'])
    df['rsi_weight'] = weight_adjustment(df['rsi'])
    df['volatility_weight'] = weight_adjustment(df['volatility'])

    total_weight = df['momentum_weight'] + df['rsi_weight'] + df['volatility_weight']
    df['momentum_contribution'] = (df['momentum'] * df['momentum_weight']) / total_weight
    df['rsi_contribution'] = (df['rsi'] * df['rsi_weight']) / total_weight
    df['volatility_contribution'] = (df['volatility'] * df['volatility_weight']) / total_weight

    heuristics_matrix = (df['momentum_contribution'] + df['rsi_contribution'] + df['volatility_contribution']).rename('heuristics')

    return heuristics_matrix
