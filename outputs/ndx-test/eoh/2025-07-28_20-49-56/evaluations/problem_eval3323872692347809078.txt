import pandas as pd

def heuristics_v2(df):
    def roc_volume(df, n=14):
        return df['volume'].pct_change(n)

    def ema_price(df, span=14):
        return df['close'].ewm(span=span, adjust=False).mean()

    def vol_penalty(df, n=30):
        return df['close'].pct_change().rolling(window=n).std() * -1

    df['roc_volume'] = roc_volume(df)
    df['ema_price'] = ema_price(df)
    df['vol_penalty'] = vol_penalty(df)

    heuristics_matrix = (df['roc_volume'] + df['ema_price'].pct_change() + df['vol_penalty']).rename('heuristics')

    return heuristics_matrix
