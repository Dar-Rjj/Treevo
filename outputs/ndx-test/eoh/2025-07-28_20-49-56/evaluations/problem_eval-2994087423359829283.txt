import pandas as pd
import numpy as np

def calculate_sma(df, window):
    return df['close'].rolling(window=window).mean()

def calculate_rsi(df, window):
    delta = df['close'].diff(1)
    gain = (delta.where(delta > 0, 0)).fillna(0)
    loss = (-delta.where(delta < 0, 0)).fillna(0)
    avg_gain = gain.rolling(window=window).mean()
    avg_loss = loss.rolling(window=window).mean()
    rs = avg_gain / avg_loss
    rsi = 100 - (100 / (1 + rs))
    return rsi

def calculate_pvt(df):
    pvt = (df['close'].pct_change() * df['volume']).cumsum()
    return pvt

def heuristics_v2(df):
    sma_short = calculate_sma(df, 10)
    sma_long = calculate_sma(df, 30)
    rsi = calculate_rsi(df, 14)
    pvt = calculate_pvt(df)
    
    heuristics_matrix = 0.4 * (sma_short / sma_long) + 0.3 * rsi + 0.3 * pvt
    return heuristics_matrix
