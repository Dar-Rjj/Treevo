```python
import pandas as pd

def heuristics_v2(df):
    # Calculate daily return
    df['daily_return'] = df['close'].diff()
    
    # Calculate average daily returns over different windows
    df['avg_5d_return'] = df['daily_return'].rolling(window=5).mean()
    df['avg_10d_return'] = df['daily_return'].rolling(window=10).mean()
    df['avg_20d_return'] = df['daily_return'].rolling(window=20).mean()
    
    # Calculate volume-weighted close price
    df['volume_weighted_close'] = df['close'] * df['volume']
    df['volume_weighted_return'] = df['volume_weighted_close'].diff()
    
    # Calculate average volume-weighted returns over different windows
    df['avg_5d_vol_weighted_return'] = df['volume_weighted_return'].rolling(window=5).mean()
    df['avg_10d_vol_weighted_return'] = df['volume_weighted_return'].rolling(window=10).mean()
    df['avg_20d_vol_weighted_return'] = df['volume_weighted_return'].rolling(window=20).mean()
    
    # Calculate daily range and relative range
    df['daily_range'] = df['high'] - df['low']
    df['relative_range'] = df['daily_range'] / df['close'].shift(1)
    
    # Calculate average relative range over different windows
    df['avg_5d_relative_range'] = df['relative_range'].rolling(window=5).mean()
    df['avg_10d_relative_range'] = df['relative_range'].rolling(window=10).mean()
    df['avg_20d_relative_range'] = df['relative_range'].rolling(window=20).mean()
    
    # Calculate overnight return
    df['overnight_return'] = df['open'] - df['close'].shift(1)
    
    # Calculate average overnight returns over different windows
    df['avg_5d_overnight_return'] = df['overnight_return'].rolling(window=5).mean()
    df['avg_10d_overnight_return'] = df['overnight_return'].rolling(window=10).mean()
    df['avg_20d_overnight_return'] = df['overnight_return'].rolling(window=20).mean()
    
    # Calculate the ratio of amount to volume
    df['avg_transaction_size'] = df['amount'] / df['volume']
    
    # Calculate moving averages of the average transaction size
    df['avg_5d_trans_size'] = df['avg_transaction_size'].rolling(window=5).mean()
    df['avg_10d_trans_size'] = df['avg_transaction_size'].rolling(window=10).mean()
    df['avg_20d_trans_size'] = df['avg_transaction_size'].rolling(window=20).mean()
    
    # Calculate daily difference in average transaction size
    df['trans_size_diff'] = df['avg_transaction_size'].diff()
    
    # Calculate moving averages of the changes in average transaction size
    df['avg_5d_trans_size_diff'] = df['trans_size_diff'].rolling(window=5).mean()
    df['avg_10d_trans_size_diff'] = df['trans_size_diff'].rolling(window=10).mean()
    df['avg_20d_trans_size_diff'] = df['trans_size_diff'].rolling(window=20).mean()
    
    # Combine multiple factors into a composite alpha factor
    df['composite_alpha'] = 0.4 * df['avg_5d_return'] + 0.3 * df['avg_5d_vol_weighted_return'] + 0.3 * df['avg_5d_overnight_return']
    
    # Calculate moving averages of the composite alpha factor
    df['avg_5d_composite_alpha'] = df['composite_alpha'].rolling(window=5).mean()
    df['avg_10d_composite_alpha'] = df['composite_alpha'].rolling(window=10).mean()
    df['avg_20d_composite_alpha'] = df['composite_alpha'].rolling(window=20).mean()
    
    # Return the composite alpha factor
    return df['composite_alpha']
```
