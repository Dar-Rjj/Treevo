```python
import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Momentum-based factors
    N = 50  # SMA window
    M = 10  # ROC window
    O = 20  # EMA window
    df['SMA'] = df['close'].rolling(window=N).mean()
    df['ROC'] = (df['close'] / df['close'].shift(M) - 1) * 100
    df['EMA'] = df['close'].ewm(span=O, adjust=False).mean()
    
    # Combine ROC and the difference between the current closing price and the SMA
    df['momentum_factor'] = df['ROC'] + (df['close'] - df['SMA'])
    
    # Volatility-based factors
    K = 14  # True range window
    L = 14  # ATR window
    S = 30  # Standard deviation window
    df['high_low'] = df['high'] - df['low']
    df['high_close'] = np.abs(df['high'] - df['close'].shift(1))
    df['low_close'] = np.abs(df['low'] - df['close'].shift(1))
    df['true_range'] = df[['high_low', 'high_close', 'low_close']].max(axis=1)
    df['ATR'] = df['true_range'].rolling(window=L).mean()
    df['std_dev'] = df['close'].rolling(window=S).std()
    
    # Combine ATR and standard deviation
    df['volatility_factor'] = df['ATR'] + df['std_dev']
    
    # Volume-based factors
    P = 20  # Moving average volume window
    Q = 10  # Cumulative volume window
    T = 10  # VWAP window
    df['avg_volume'] = df['volume'].rolling(window=P).mean()
    df['volume_ratio'] = df['volume'] / df['avg_volume']
    df['up_volume'] = df[df['close'] > df['open']]['volume'].rolling(window=Q).sum().fillna(0)
    df['down_volume'] = df[df['close'] < df['open']]['volume'].rolling(window=Q).sum().fillna(0)
    df['VWAP'] = (df['volume'] * (df['high'] + df['low'] + df['close']) / 3).rolling(window=T).sum() / df['volume'].rolling(window=T).sum()
    df['vwap_diff'] = df['close'] - df['VWAP']
    
    # Composite volume factor
    df['volume_factor'] = df['vwap_diff'] + (df['up_volume'] - df['down_volume'])
    
    # Pattern recognition for alpha generation
    df['doji'] = ((df['high'] - df['low']) / (df['high'] + df['low'])) < 0.005
    df['hammer'] = (df['close'] - df['low']) / (df['high'] - df['low']) > 0.66
    df['engulfing_bullish'] = (df['close'] > df['open']) & (df['close'].shift(1) < df['open'].shift(1)) & (df['close'] > df['open'].shift(1)) & (df['open'] < df['close'].shift(1))
    df['engulfing_bearish'] = (df['close'] < df['open']) & (df['close'].shift(1) > df['open'].shift(1)) & (df['close'] < df['open'].shift(1)) & (df['open'] > df['close'].shift(1))
    df['bullish_patterns'] = df['doji'] | df['hammer'] | df['engulfing_bullish']
    df['bearish_patterns'] = df['engulfing_bearish']
    
    # Composite pattern score
    df['pattern_score'] = df['bullish_patterns'].astype(int) - df['bearish_patterns'].astype(int)
    
    # Inter-day price and volume relationships
    df['price_ratio'] = df['close'] / df['close'].shift(1)
    df['volume_ratio_interday'] = df['volume'] / df['volume'].shift(1)
    df['interday_factor'] = (df['price_ratio'] - 1) * df['volume_ratio_interday']
    
    # High and low price information
    df['range'] = df['high'] - df['low']
    df['range_ratio'] = df['range'] / df['range'].shift(1)
    df
