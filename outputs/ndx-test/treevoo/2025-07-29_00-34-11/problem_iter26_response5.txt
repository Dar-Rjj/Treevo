```python
import pandas as pd

def heuristics_v2(df):
    # Momentum based on close prices
    short_sma = df['close'].rolling(window=5).mean()
    long_sma = df['close'].rolling(window=20).mean()
    momentum_signal = short_sma - long_sma
    buy_signal = (short_sma > long_sma) & (short_sma.shift(1) <= long_sma.shift(1))
    sell_signal = (short_sma < long_sma) & (short_sma.shift(1) >= long_sma.shift(1))

    # Volume and amount analysis
    vwap = (df['close'] * df['volume']).cumsum() / df['volume'].cumsum()
    vwap_change = vwap.pct_change()
    avg_volume = df['volume'].rolling(window=20).mean()
    volume_spike = df['volume'] / avg_volume

    # Volatility using high, low, and close prices
    true_range = df[['high', 'low', 'close']].apply(lambda x: max(x[0] - x[1], abs(x[0] - x[2].shift(1)), abs(x[1] - x[2].shift(1))), axis=1)
    atr = true_range.rolling(window=14).mean()
    ema_close = df['close'].ewm(span=20, adjust=False).mean()
    upper_band = ema_close + atr * 2
    lower_band = ema_close - atr * 2
    volatility_buy_signal = (df['close'] > upper_band) & (df['close'].shift(1) <= upper_band.shift(1))
    volatility_sell_signal = (df['close'] < lower_band) & (df['close'].shift(1) >= lower_band.shift(1))

    # Market sentiment using open and close prices
    daily_return = (df['close'] - df['open']) / df['open']
    cumulative_return = (1 + daily_return).rolling(window=5).apply(lambda r: r.prod()) - 1
    positive_returns = (daily_return > 0).rolling(window=5).sum()
    negative_returns = (daily_return < 0).rolling(window=5).sum()
    sentiment_trend = positive_returns - negative_returns

    # Trend detection with moving averages
    ema_5 = df['close'].ewm(span=5, adjust=False).mean()
    ema_20 = df['close'].ewm(span=20, adjust=False).mean()
    ema_trend = ema_5 - ema_20
    ema_buy_signal = (ema_5 > ema_20) & (ema_5.shift(1) <= ema_20.shift(1))
    ema_sell_signal = (ema_5 < ema_20) & (ema_5.shift(1) >= ema_20.shift(1))

    # Combine factors
    composite_score = (
        0.3 * momentum_signal +
        0.2 * vwap_change +
        0.2 * ema_trend +
        0.1 * atr +
        0.2 * sentiment_trend
    )
    composite_buy_signal = (composite_score > 0.05)
    composite_sell_signal = (composite_score < -0.05)

    return pd.Series(composite_score, index=df.index)

# Example usage:
# df = pd.read_csv('stock_data.csv')
# df.set_index('date', inplace=True)
# factor_values = heuristics_v2(df)
# print(factor_values)
```
