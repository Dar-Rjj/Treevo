import pandas as pd

def heuristics_v2(df):
    def calculate_factor(sub_df):
        # Short term momentum with volume
        short_momentum = (sub_df['close'].diff() * sub_df['volume']).rolling(window=5).mean()
        # Medium term momentum with volume
        medium_momentum = (sub_df['close'].diff().rolling(window=10).sum() * sub_df['volume']).rolling(window=10).mean()
        # Long term reversal with volume
        long_reversal = (sub_df['close'].diff(-20).fillna(0) * sub_df['volume']).rolling(window=20).mean()
        return 0.4*short_momentum + 0.3*medium_momentum + 0.3*long_reversal

    heuristics_matrix = df.apply(calculate_factor, axis=0)
    heuristics_matrix = heuristics_matrix.fillna(0)
    
    return heuristics_matrix
