import pandas as pd

def heuristics_v2(df):
    def compute_macd(price_series, n_fast=9, n_slow=21):
        ema_fast = price_series.ewm(span=n_fast, min_periods=n_fast).mean()
        ema_slow = price_series.ewm(span=n_slow, min_periods=n_slow).mean()
        macd = ema_fast - ema_slow
        return macd

    def compute_rsi(price_series, periods=10):
        delta = price_series.diff(1)
        gain = (delta.where(delta > 0, 0)).fillna(0)
        loss = (-delta.where(delta < 0, 0)).fillna(0)
        avg_gain = gain.rolling(window=periods, min_periods=periods).mean()
        avg_loss = loss.rolling(window=periods, min_periods=periods).mean()
        rs = avg_gain / avg_loss
        rsi = 100 - (100 / (1 + rs))
        return rsi

    def compute_stochastic_oscillator(high, low, close, k_period=10, d_period=5):
        l14 = low.rolling(window=k_period, min_periods=k_period).min()
        h14 = high.rolling(window=k_period, min_periods=k_period).max()
        k_percent = 100 * ((close - l14) / (h14 - l14))
        d_percent = k_percent.rolling(window=d_period, min_periods=d_period).mean()
        return d_percent

    close_prices = df['close']
    high_prices = df['high']
    low_prices = df['low']
    
    macd_values = compute_macd(close_prices)
    rsi_values = compute_rsi(close_prices)
    stoch_osc_values = compute_stochastic_oscillator(high_prices, low_prices, close_prices)
    
    # Heuristic matrix: combination of MACD, RSI, and Stochastic Oscillator
    heuristics_matrix = (macd_values + rsi_values + stoch_osc_values) / 3
    return heuristics_matrix
