import pandas as pd

def heuristics_v2(df):
    # Calculate DMI
    high_diff = df['high'].diff()
    low_diff = -df['low'].diff()
    positive_dm = high_diff.where(high_diff > low_diff, 0).fillna(0)
    negative_dm = low_diff.where(low_diff > high_diff, 0).fillna(0)
    tr = pd.concat([df['high']-df['low'], 
                    abs(df['high']-df['close'].shift()), 
                    abs(df['low']-df['close'].shift())], axis=1).max(axis=1)
    tr_14 = tr.rolling(window=14).sum()
    pos_dm_14 = positive_dm.rolling(window=14).sum()
    neg_dm_14 = negative_dm.rolling(window=14).sum()
    pos_di = 100 * (pos_dm_14 / tr_14)
    neg_di = 100 * (neg_dm_14 / tr_14)
    dmi = abs(pos_di - neg_di)

    # Calculate MFI
    typical_price = (df['high'] + df['low'] + df['close']) / 3
    raw_money_flow = typical_price * df['volume']
    positive_flow = raw_money_flow.where(typical_price > typical_price.shift(1), 0)
    negative_flow = raw_money_flow.where(typical_price < typical_price.shift(1), 0)
    positive_flow_14 = positive_flow.rolling(window=14).sum()
    negative_flow_14 = negative_flow.rolling(window=14).sum()
    mfi = 100 - (100 / (1 + (positive_flow_14 / negative_flow_14)))

    # Calculate Relative Position Indicator
    relative_position = (df['close'] - df['low']) / (df['high'] - df['low'])

    # Combine factors
    heuristics_matrix = 0.4 * dmi + 0.4 * mfi + 0.2 * relative_position
    return heuristics_matrix
