import pandas as pd

def heuristics_v2(df):
    # Calculate Bollinger Bands
    sma_period = 20
    std_dev = 2
    df['SMA'] = df['close'].rolling(window=sma_period).mean()
    df['STD'] = df['close'].rolling(window=sma_period).std()
    df['Upper_BB'] = df['SMA'] + (df['STD'] * std_dev)
    df['Lower_BB'] = df['SMA'] - (df['STD'] * std_dev)
    df['BB_Width'] = df['Upper_BB'] - df['Lower_BB']

    # Calculate CMF
    cmf_period = 20
    money_flow_multiplier = ((df['close'] - df['low']) - (df['high'] - df['close'])) / (df['high'] - df['low'])
    money_flow_volume = money_flow_multiplier * df['volume']
    df['CMF'] = money_flow_volume.rolling(window=cmf_period).sum() / df['volume'].rolling(window=cmf_period).sum()

    # Calculate SMA crossovers
    short_sma_period = 50
    long_sma_period = 200
    df['SMA_Short'] = df['close'].rolling(window=short_sma_period).mean()
    df['SMA_Long'] = df['close'].rolling(window=long_sma_period).mean()
    sma_crossover = df['SMA_Short'] - df['SMA_Long']

    # Combined heuristic: BB Width adjusted by CMF and SMA crossover
    heuristics_matrix = df['BB_Width'] + (df['CMF'] - 0.5) * 0.01 * df['BB_Width'] + sma_crossover

    return heuristics_matrix
