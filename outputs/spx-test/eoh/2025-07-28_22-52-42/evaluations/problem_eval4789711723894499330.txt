import pandas as pd

def heuristics_v2(df):
    # Calculate the true range
    df['True_Range'] = df[['high', 'low', 'close']].apply(lambda x: max(x) - min(x), axis=1)
    
    # Calculate average true range (ATR) over 14 days
    df['ATR_14'] = df['True_Range'].rolling(window=14).mean()
    
    # Directional Movement Index components
    df['DM_pos'] = df['high'].diff().apply(lambda x: max(x, 0))
    df['DM_neg'] = -df['low'].diff().apply(lambda x: min(x, 0))
    
    # Smoothed DM values
    df['DM_pos_14'] = df['DM_pos'].rolling(window=14).sum()
    df['DM_neg_14'] = df['DM_neg'].rolling(window=14).sum()
    
    # Calculate +DI and -DI
    df['DI_pos'] = (df['DM_pos_14'] / df['ATR_14']) * 100
    df['DI_neg'] = (df['DM_neg_14'] / df['ATR_14']) * 100
    
    # Directional Movement Index (DX)
    df['DX'] = (abs(df['DI_pos'] - df['DI_neg']) / (df['DI_pos'] + df['DI_neg'])) * 100
    
    # Volume-weighted DI difference
    df['DI_Diff_VW'] = (df['DI_pos'] - df['DI_neg']) * df['volume']
    
    # Heuristic factor combining ATR, DX, and volume-weighted DI difference
    df['Heuristic_Factor'] = df['ATR_14'] + df['DX'] + df['DI_Diff_VW']
    
    # Return the heuristic factor as a Series
    heuristics_matrix = df['Heuristic_Factor']
    return heuristics_matrix
