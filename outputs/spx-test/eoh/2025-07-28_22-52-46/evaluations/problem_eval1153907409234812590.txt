def heuristics_v2(df):
    # Compute daily return
    df['daily_return'] = df['close'].pct_change()
    
    # Compute exponential moving averages for close price
    df['ema_5'] = df['close'].ewm(span=5, adjust=False).mean()
    df['ema_10'] = df['close'].ewm(span=10, adjust=False).mean()
    
    # Calculate EMA ratio
    df['ema_ratio'] = df['ema_5'] / df['ema_10']
    
    # Volume difference
    df['volume_diff'] = df['volume'] - df['volume'].rolling(window=30).mean()
    
    # Rolling 30-day historical betas
    beta_ema_ratio = (df['ema_ratio'] * df['daily_return'].shift(-1)).rolling(window=30).cov() / df['daily_return'].shift(-1).rolling(window=30).var()
    beta_volume_diff = (df['volume_diff'] * df['daily_return'].shift(-1)).rolling(window=30).cov() / df['daily_return'].shift(-1).rolling(window=30).var()
    
    # Generate heuristic matrix
    heuristics_matrix = df['ema_ratio'] * beta_ema_ratio + df['volume_diff'] * beta_volume_diff
    
    return heuristics_matrix
