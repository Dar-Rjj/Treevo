import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Calculate the log returns
    df['log_returns'] = np.log(df['close'] / df['close'].shift(1))
    
    # Compute the 20-day rolling standard deviation of log returns for measuring volatility
    volatility = df['log_returns'].rolling(window=20).std()
    
    # Determine the daily price direction (positive or negative)
    df['direction'] = np.where(df['close'] > df['open'], 1, -1)
    
    # Calculate the 20-day rolling sum of positive and negative days
    positive_days = df['direction'].rolling(window=20).apply(lambda x: (x == 1).sum(), raw=True)
    negative_days = df['direction'].rolling(window=20).apply(lambda x: (x == -1).sum(), raw=True)
    
    # Generate the sentiment score as the ratio of positive to negative days
    sentiment_score = positive_days / negative_days
    
    # Generate the heuristic matrix combining volatility and sentiment
    heuristics_matrix = volatility * sentiment_score
    
    return heuristics_matrix
