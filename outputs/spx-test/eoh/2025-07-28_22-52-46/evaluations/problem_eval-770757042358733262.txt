def heuristics_v2(df):
    # Compute daily return
    df['daily_return'] = df['close'].pct_change()
    
    # Compute 10-day and 50-day exponential moving averages for close price
    df['ema_10'] = df['close'].ewm(span=10, adjust=False).mean()
    df['ema_50'] = df['close'].ewm(span=50, adjust=False).mean()
    
    # Calculate deviations from EMA
    df['dev_ema_10'] = df['close'] - df['ema_10']
    df['dev_ema_50'] = df['close'] - df['ema_50']
    
    # Volume trend relative to 20-day average
    df['avg_volume_20'] = df['volume'].rolling(window=20).mean()
    df['vol_ratio'] = df['volume'] / df['avg_volume_20']
    
    # Historical contributions to future returns
    contribution_dev_ema_10 = (df['dev_ema_10'] * df['daily_return'].shift(-1)).mean()
    contribution_dev_ema_50 = (df['dev_ema_50'] * df['daily_return'].shift(-1)).mean()
    contribution_vol_ratio = (df['vol_ratio'] * df['daily_return'].shift(-1)).mean()
    contribution_daily_return = (df['daily_return'] * df['daily_return'].shift(-1)).mean()
    
    # Generate heuristic matrix
    heuristics_matrix = (df['dev_ema_10'] * contribution_dev_ema_10 +
                         df['dev_ema_50'] * contribution_dev_ema_50 +
                         df['vol_ratio'] * contribution_vol_ratio +
                         df['daily_return'] * contribution_daily_return)
    
    return heuristics_matrix
