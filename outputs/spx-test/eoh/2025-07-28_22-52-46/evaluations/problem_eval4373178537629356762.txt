import pandas as pd

def heuristics_v2(df):
    # Compute daily return
    df['daily_return'] = df['close'].pct_change()
    
    # Compute simple moving averages for close price
    df['sma_50'] = df['close'].rolling(window=50).mean()
    df['sma_100'] = df['close'].rolling(window=100).mean()
    
    # Calculate momentum
    df['momentum'] = df['close'] - df['close'].shift(10)
    
    # Calculate price relative to SMA
    df['price_to_sma_50'] = df['close'] / df['sma_50']
    df['price_to_sma_100'] = df['close'] / df['sma_100']
    
    # Volume trend
    df['volume_trend'] = df['volume'].rolling(window=50).mean() / df['volume'].rolling(window=100).mean()
    
    # Volatility
    df['volatility_momentum'] = df['momentum'].rolling(window=50).std()
    df['volatility_price_to_sma_50'] = df['price_to_sma_50'].rolling(window=50).std()
    df['volatility_price_to_sma_100'] = df['price_to_sma_100'].rolling(window=50).std()
    df['volatility_volume_trend'] = df['volume_trend'].rolling(window=50).std()
    
    # Historical volatility-based weights
    volatility_weights = {
        'momentum': 1 / df['volatility_momentum'],
        'price_to_sma_50': 1 / df['volatility_price_to_sma_50'],
        'price_to_sma_100': 1 / df['volatility_price_to_sma_100'],
        'volume_trend': 1 / df['volatility_volume_trend']
    }
    
    # Generate heuristic matrix using volatility-based weights
    heuristics_matrix = (df['momentum'] * volatility_weights['momentum'] +
                         df['price_to_sma_50'] * volatility_weights['price_to_sma_50'] +
                         df['price_to_sma_100'] * volatility_weights['price_to_sma_100'] +
                         df['volume_trend'] * volatility_weights['volume_trend'])
    
    return heuristics_matrix
