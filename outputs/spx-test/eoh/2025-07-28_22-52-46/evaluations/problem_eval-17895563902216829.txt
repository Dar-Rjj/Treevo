import pandas as pd
import ta

def heuristics_v2(df):
    # Compute daily return
    df['daily_return'] = df['close'].pct_change()
    
    # Calculate RSI
    df['rsi'] = ta.momentum.RSIIndicator(close=df['close']).rsi()
    
    # Calculate ADX
    df['adx'] = ta.trend.ADXIndicator(high=df['high'], low=df['low'], close=df['close']).adx()
    
    # Calculate OBV
    df['obv'] = ta.volume.OnBalanceVolumeIndicator(close=df['close'], volume=df['volume']).on_balance_volume()
    
    # Rolling 60-day historical ICs
    ic_rsi = (df['rsi'] * df['daily_return'].shift(-1)).rolling(window=60).mean()
    ic_adx = (df['adx'] * df['daily_return'].shift(-1)).rolling(window=60).mean()
    ic_obv = (df['obv'] * df['daily_return'].shift(-1)).rolling(window=60).mean()
    
    # Generate heuristic matrix
    heuristics_matrix = (df['rsi'] * ic_rsi + df['adx'] * ic_adx + df['obv'] * ic_obv)
    
    return heuristics_matrix
