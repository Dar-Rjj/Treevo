```python
import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Calculate daily return
    df['daily_return'] = (df['close'] - df['open']) / df['open']
    
    # Calculate intraday volatility
    df['intraday_volatility'] = (df['high'] - df['low']) / df['open']
    
    # Calculate high-low spread
    df['high_low_spread'] = df['high'] - df['low']
    
    # Calculate close-open spread
    df['close_open_spread'] = df['close'] - df['open']
    
    # Calculate combined spreads
    df['combined_spreads'] = (df['high'] - df['low']) + (df['close'] - df['open'])
    
    # Calculate simple moving average (SMA) of close prices
    df['sma_close'] = df['close'].rolling(window=21).mean()
    
    # Calculate SMA ratio
    df['sma_ratio'] = df['close'] / df['sma_close']
    
    # Calculate exponential moving average (EMA) of close prices
    df['ema_close'] = df['close'].ewm(span=21, adjust=False).mean()
    
    # Calculate EMA ratio
    df['ema_ratio'] = df['close'] / df['ema_close']
    
    # Calculate 7-day EMA of high-to-low range
    df['ema_7_high_low'] = (df['high'] - df['low']).ewm(span=7, adjust=False).mean()
    
    # Calculate 21-day EMA of high-to-low range
    df['ema_21_high_low'] = (df['high'] - df['low']).ewm(span=21, adjust=False).mean()
    
    # Calculate momentum signal
    df['momentum_signal'] = df['ema_7_high_low'] / df['ema_21_high_low']
    
    # Calculate momentum signal adjusted
    df['momentum_signal_adjusted'] = (df['ema_7_high_low'] / df['ema_21_high_low']) * (df['high'] - df['low'])
    
    # Calculate volume ratio
    df['sma_volume'] = df['volume'].rolling(window=21).mean()
    df['volume_ratio'] = df['volume'] / df['sma_volume']
    
    # Calculate price-volume momentum
    df['price_volume_momentum'] = (df['close'] - df['open']) * df['volume']
    
    # Calculate large trade indicator
    df['large_trade_indicator'] = np.where(df['volume'] > 2 * df['sma_volume'], 1, 0)
    
    # Calculate volume-weighted high-low difference
    df['vwhld'] = (df['high'] - df['low']) * df['volume']
    
    # Calculate 14-day SMA of volume-weighted high-low difference
    df['sma_vwhld'] = df['vwhld'].rolling(window=14).mean()
    
    # Calculate smoothed raw momentum
    df['smoothed_raw_momentum'] = (df['vwhld'] - df['sma_vwhld']) * 0.2
    
    # Calculate dynamic momentum adjustment
    df['dynamic_momentum_adjustment'] = df['smoothed_raw_momentum'] / (df['ema_7_high_low'] / df['ema_21_high_low'])
    
    # Calculate composite factor
    df['composite_factor'] = (df['sma_ratio'] + df['ema_ratio'] + df['intraday_volatility'] + 
                              df['volume_ratio'] + df['price_volume_momentum'] + df['large_trade_indicator'] + 
                              df['momentum_signal_adjusted'] + df['dynamic_momentum_adjustment'])
    
    # Calculate 5-day momentum
    df['5_day_momentum'] = df['close'].pct_change(periods=5).fillna(0)
    
    # Calculate consistency of momentum
    df['consistency_of_momentum'] = (df['daily_return'] > 0).rolling(window=5).sum()
    
    # Calculate distance from 200-day moving average
    df['sma_200_close'] = df['close'].rolling(window=200).mean()
    df['distance_from_200_sma'] = df['close'] - df['sma_200_close']
    
    # Calculate Z-score of current close relative to 200-day mean
    df['z_score_200'] = (df['close'] - df['sma_200_close']) / df['close'].rolling(window=200).std()
    
    # Calculate adjusted Z
