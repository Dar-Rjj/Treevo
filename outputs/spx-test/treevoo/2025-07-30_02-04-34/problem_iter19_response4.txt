```python
import pandas as pd
import numpy as np

def heuristics_v2(df, N=20, M=12, P=14, Q=14, R=14, S=14):
    # Simple Moving Average (SMA) over N days
    df['SMA'] = df['close'].rolling(window=N).mean()
    
    # Exponential Moving Average (EMA) over M days
    df['EMA'] = df['close'].ewm(span=M, adjust=False).mean()
    
    # Rate of Change (ROC) of close price over P days
    df['ROC'] = df['close'].pct_change(periods=P)
    
    # Average True Range (ATR) over Q days
    df['TR'] = np.maximum(np.maximum(df['high'] - df['low'], 
                                     np.abs(df['high'] - df['close'].shift(1))), 
                          np.abs(df['low'] - df['close'].shift(1)))
    df['ATR'] = df['TR'].rolling(window=Q).mean()
    
    # Bollinger Bands (BB) calculation, including upper and lower bands
    df['BB_Middle'] = df['SMA']
    df['BB_Upper'] = df['BB_Middle'] + 2 * df['close'].rolling(window=N).std()
    df['BB_Lower'] = df['BB_Middle'] - 2 * df['close'].rolling(window=N).std()
    
    # Find local minima and maxima for potential support and resistance
    df['Local_Min'] = df['low'].rolling(window=R, center=True).min()
    df['Local_Max'] = df['high'].rolling(window=R, center=True).max()
    
    # Cumulative Volume Delta (CVD)
    df['CVD'] = (df['volume'] * np.where(df['close'] > df['open'], 1, -1)).cumsum()
    
    # On-Balance Volume (OBV)
    df['OBV'] = (df['volume'] * np.where(df['close'] > df['open'], 1, -1)).cumsum()
    
    # Identify bullish and bearish engulfing patterns
    df['Engulfing_Bullish'] = ((df['open'] < df['close']) & 
                               (df['open'].shift(1) > df['close'].shift(1)) & 
                               (df['close'] > df['open'].shift(1)) & 
                               (df['open'] < df['close'].shift(1)))
    df['Engulfing_Bearish'] = ((df['open'] > df['close']) & 
                               (df['open'].shift(1) < df['close'].shift(1)) & 
                               (df['close'] < df['open'].shift(1)) & 
                               (df['open'] > df['close'].shift(1)))
    
    # Detect hammer, hanging man, and doji candles
    df['Hammer'] = ((df['close'] > df['open']) & 
                    (2 * (df['close'] - df['open']) <= (df['high'] - df['low'])) & 
                    ((df['close'] - df['low']) / (df['high'] - df['low']) >= 0.6))
    df['Hanging_Man'] = ((df['close'] < df['open']) & 
                         (2 * (df['open'] - df['close']) <= (df['high'] - df['low'])) & 
                         ((df['close'] - df['low']) / (df['high'] - df['low']) >= 0.6))
    df['Doji'] = (np.abs(df['close'] - df['open']) / (df['high'] - df['low']) <= 0.1)
    
    # Williams %R over R days
    df['Williams_R'] = -100 * (df['high'].rolling(window=R).max() - df['close']) / \
                       (df['high'].rolling(window=R).max() - df['low'].rolling(window=R).min())
    
    # Stochastic Oscillator over S days
    high_roll = df['high'].rolling(window=S).max()
    low_roll = df['low'].rolling(window=S).min()
    df['%K'] = 100 * (df['close'] - low_roll) / (high_roll - low_roll)
    df['%D'] = df['%K'].rolling(window=3).mean()
    
    # Combine all indicators to create a final alpha factor
    df['alpha_factor'] = (df['SMA'] - df['EMA']) + df['ROC'] + df['ATR'] + \
                         (df
