```python
import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Momentum-Based Factor
    short_term_momentum = (df['close'] - df['close'].shift(5)) / df['close'].shift(5)
    long_term_momentum = (df['close'] - df['close'].shift(20)) / df['close'].shift(20)
    momentum_difference = short_term_momentum - long_term_momentum

    # Volume-Based Factor
    volume_change = df['volume'] - df['volume'].shift(1)
    average_volume = df['volume'].rolling(window=5).mean()
    volume_change_factor = volume_change / average_volume

    # Price Action Factor
    daily_range = df['high'] - df['low']
    daily_spread = df['close'] - df['open']
    price_action_factor = daily_spread / daily_range

    # Intraday Analysis
    intraday_high_low_spread = df['high'] - df['low']
    close_open_spread = df['close'] - df['open']
    smoothed_intraday_return = (intraday_high_low_spread / df['close']).ewm(span=5, min_periods=5).mean().shift(1)

    # Volume Spike Detection
    volume_change_rolling = df['volume'].diff().rolling(window=20).mean()
    volume_spike = (df['volume'] - df['volume'].shift(1) > 2 * volume_change_rolling).astype(int)
    intraday_momentum_volume_impact = (smoothed_intraday_return * volume_spike).rolling(window=4).mean().shift(1)

    # Moving Averages
    sma_5 = df['close'].rolling(window=5).mean()
    sma_10 = df['close'].rolling(window=10).mean()
    sma_20 = df['close'].rolling(window=20).mean()
    ema_5 = df['close'].ewm(span=5, adjust=False).mean()
    ema_10 = df['close'].ewm(span=10, adjust=False).mean()
    ema_20 = df['close'].ewm(span=20, adjust=False).mean()
    smacd = sma_5 - sma_20

    # Composite Factor
    factor = (
        0.4 * momentum_difference +
        0.3 * volume_change_factor +
        0.1 * price_action_factor +
        0.2 * intraday_momentum_volume_impact
    )

    return factor
```
