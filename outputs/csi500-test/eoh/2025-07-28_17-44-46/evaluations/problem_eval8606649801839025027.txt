import pandas as pd

def heuristics_v2(df):
    # Calculate the 20-day and 100-day Simple Moving Average (SMA) of close prices
    sma_close_20 = df['close'].rolling(window=20).mean()
    sma_close_100 = df['close'].rolling(window=100).mean()
    
    # Generate the new factor by dividing the 20-day SMA of close prices by the 100-day SMA of close prices
    factor_price_ratio = sma_close_20 / sma_close_100
    
    # Calculate the 30-day Average True Range (ATR)
    tr = pd.DataFrame({
        'h-l': df['high'] - df['low'],
        'h-pc': abs(df['high'] - df['close'].shift(1)),
        'l-pc': abs(df['low'] - df['close'].shift(1))
    }).max(axis=1)
    atr_30 = tr.rolling(window=30).mean()
    
    # Combine the price ratio with the ATR
    heuristics_matrix = factor_price_ratio * atr_30
    
    return heuristics_matrix
