import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Calculate the 20-day linear regression slope
    def calculate_slope(series):
        x = np.arange(len(series))
        y = series.values
        A = np.vstack([x, np.ones(len(x))]).T
        m, c = np.linalg.lstsq(A, y, rcond=None)[0]
        return m
    
    df['slope_20d'] = df['close'].rolling(window=20).apply(calculate_slope, raw=False)
    
    # Calculate the 20-day standard deviation of daily returns
    df['daily_returns'] = df['close'].pct_change()
    df['std_dev_20d'] = df['daily_returns'].rolling(window=20).std()
    
    # Composite factor: weighted sum of 20-day slope and 20-day standard deviation
    df['composite_factor'] = (df['slope_20d'] * 0.6 + 
                              df['std_dev_20d'] * 0.4)
    
    heuristics_matrix = df['composite_factor'].dropna()
    
    return heuristics_matrix
