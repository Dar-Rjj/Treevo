import pandas as pd
import ta

def heuristics_v2(df):
    # Modified Momentum: 20-day change in closing price
    modified_momentum = df['close'].pct_change(20)
    
    # Volatility using RSI over the last 14 days
    rsi = ta.momentum.RSIIndicator(df['close'], window=14).rsi()
    volatility = (100 - rsi) / 100  # Normalize RSI to be between 0 and 1
    
    # Volume-Activity Ratio: Exponential Moving Average (EMA) for 5 days divided by EMA for 60 days
    vol_ema_5d = df['volume'].ewm(span=5, adjust=False).mean()
    vol_ema_60d = df['volume'].ewm(span=60, adjust=False).mean()
    vol_activity_ratio = vol_ema_5d / vol_ema_60d
    
    # Combine the calculated features into a single factor
    heuristics_matrix = (modified_momentum - volatility) * vol_activity_ratio
    
    return heuristics_matrix
