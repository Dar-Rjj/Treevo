def heuristics_v2(df):
    df['ema_20'] = df['close'].ewm(span=20, adjust=False).mean()
    df['distance_to_ema'] = abs(df['close'] - df['ema_20'])
    df['positive_volume_days'] = (df['volume'].pct_change() > 0).rolling(window=30).sum()
    df['negative_volume_days'] = (df['volume'].pct_change() < 0).rolling(window=30).sum()
    df['volume_ratio_pos_neg_vol_mean_adjusted'] = df['positive_volume_days'] / (df['negative_volume_days'] + 1e-8) / df['volume'].rolling(window=30).mean()
    df['price_std_dev'] = (df['high'] - df['low']).rolling(window=20).std()
    df['composite_factor'] = (df['distance_to_ema'] * 0.4 + 
                              df['volume_ratio_pos_neg_vol_mean_adjusted'] * 0.3 + 
                              df['price_std_dev'] * 0.3)
    heuristics_matrix = df['composite_factor'].copy()
    return heuristics_matrix
