def heuristics_v2(df):
    # Calculate the 20-day exponential moving average of the closing price
    df['ema_20'] = df['close'].ewm(span=20, adjust=False).mean()
    
    # Calculate the absolute difference between the closing price and the 20-day EMA
    df['distance_to_ema'] = abs(df['close'] - df['ema_20'])
    
    # Count the number of positive and negative volume change days over the last 20 days
    df['positive_volume_days'] = (df['volume'].pct_change() > 0).rolling(window=20).sum()
    df['negative_volume_days'] = (df['volume'].pct_change() < 0).rolling(window=20).sum()
    
    # Adjust the volume ratio by dividing it by the mean absolute deviation of the last 20 days' volume
    df['volume_ratio_pos_neg_mad_adjusted'] = df['positive_volume_days'] / (df['negative_volume_days'] + 1e-8) / df['volume'].rolling(window=20).mad()
    
    # Calculate the coefficient of variation of daily price changes (difference between high and low) over the last 5 days
    df['price_cv'] = ((df['high'] - df['low']).rolling(window=5).std()) / df['close'].rolling(window=5).mean()
    
    # Composite factor: weighted sum of distance to EMA, MAD-adjusted volume ratio, and price coefficient of variation
    df['composite_factor'] = (df['distance_to_ema'] * 0.4 + 
                              df['volume_ratio_pos_neg_mad_adjusted'] * 0.3 + 
                              df['price_cv'] * 0.3)
    
    heuristics_matrix = df['composite_factor'].copy()
    
    return heuristics_matrix
