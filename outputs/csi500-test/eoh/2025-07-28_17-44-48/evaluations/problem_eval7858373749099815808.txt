import pandas as pd

def heuristics_v2(df):
    def compute_factor(row, df_slice):
        close_prices = df_slice['close']
        volumes = df_slice['volume']
        ema_close = close_prices.ewm(span=10, adjust=False).mean().iloc[-1]
        sma_volume = volumes.rolling(window=10, min_periods=1).mean().iloc[-1]
        return ema_close / sma_volume
    df['date'] = pd.to_datetime(df.index)
    heuristics_matrix = df.groupby('date').apply(lambda x: compute_factor(x, x))
    return heuristics_matrix
