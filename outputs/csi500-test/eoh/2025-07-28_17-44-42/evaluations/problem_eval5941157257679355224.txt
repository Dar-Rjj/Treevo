import pandas as pd
    import numpy as np
    
    def calculate_rsi(series, window=14):
        delta = series.diff(1)
        gain = delta.where(delta > 0, 0)
        loss = -delta.where(delta < 0, 0)
        avg_gain = gain.rolling(window=window).mean()
        avg_loss = loss.rolling(window=window).mean()
        rs = avg_gain / avg_loss
        rsi = 100 - (100 / (1 + rs))
        return rsi
    
    def calculate_atr(df, window=14):
        high_low = df['high'] - df['low']
        high_close = np.abs(df['high'] - df['close'].shift())
        low_close = np.abs(df['low'] - df['close'].shift())
        tr = pd.concat([high_low, high_close, low_close], axis=1).max(axis=1)
        atr = tr.rolling(window=window).mean()
        return atr

    def log_return(series):
        return np.log(series) - np.log(series.shift(1))

    # Calculate RSI
    df['rsi'] = calculate_rsi(df['close'])

    # Calculate ATR
    df['atr'] = calculate_atr(df)

    # Calculate log return
    df['log_ret'] = log_return(df['close'])

    # Calculate z-scores for RSI, ATR, and log returns
    df['rsi_zscore'] = (df['rsi'] - df['rsi'].mean()) / df['rsi'].std()
    df['atr_zscore'] = (df['atr'] - df['atr'].mean()) / df['atr'].std()
    df['log_ret_zscore'] = (df['log_ret'] - df['log_ret'].mean()) / df['log_ret'].std()

    # Composite factor: weighted sum of z-scores
    heuristics_matrix = df['rsi_zscore'] + df['atr_zscore'] + df['log_ret_zscore']

    return heuristics_matrix
