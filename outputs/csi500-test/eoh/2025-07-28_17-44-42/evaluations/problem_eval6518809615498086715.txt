import pandas as pd
from sklearn.linear_model import LinearRegression

def heuristics_v2(df):
    X = df.index.values.reshape(-1, 1).astype(int)
    y = df['close'].values
    model = LinearRegression().fit(X[-30:], y[-30:])
    predicted_close = model.predict(X)
    difference = df['close'] - predicted_close
    heuristics_matrix = difference.rolling(window=20).mean()
    return heuristics_matrix
