import pandas as pd

def calculate_volatility(series, window):
    return series.rolling(window=window).std()

def calculate_rsi(series, window):
    delta = series.diff(1)
    up, down = delta.copy(), delta.copy()
    up[up < 0] = 0
    down[down > 0] = 0
    roll_up = up.rolling(window).mean()
    roll_down = down.abs().rolling(window).mean()
    rs = roll_up / roll_down
    rsi = 100.0 - (100.0 / (1.0 + rs))
    return rsi

def heuristics_v2(df):
    # Calculate volatility for close prices over 10 and 30 days
    df['volatility_10d'] = calculate_volatility(df['close'], window=10)
    df['volatility_30d'] = calculate_volatility(df['close'], window=30)
    
    # Calculate RSI for close prices over 10 and 30 days
    df['rsi_10d'] = calculate_rsi(df['close'], window=10)
    df['rsi_30d'] = calculate_rsi(df['close'], window=30)
    
    # Weights for the linear combination (example values)
    weights = {'volatility_10d': 0.4, 'volatility_30d': 0.6, 'rsi_10d': 0.3, 'rsi_30d': 0.7}
    
    # Generate the heuristics factor
    heuristics_series = df.apply(lambda row: sum(row[col] * weights[col] for col in weights.keys()), axis=1)
    
    heuristics_matrix = heuristics_series.to_frame(name='heuristics_value')
    
    return heuristics_matrix
