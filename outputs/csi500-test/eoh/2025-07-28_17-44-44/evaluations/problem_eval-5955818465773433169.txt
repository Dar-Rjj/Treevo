def heuristics_v2(df):
    tr = df[['high', 'low', 'close']].apply(lambda x: max(x['high'] - x['low'], abs(x['high'] - x['close'].shift()), abs(x['low'] - x['close'].shift())), axis=1)
    atr_10 = tr.rolling(window=10).mean()
    atr_20 = tr.rolling(window=20).mean()
    
    atr_ratio = atr_10 / atr_20
    
    ema_30_volume = df['volume'].ewm(span=30, adjust=False).mean()
    high_30 = df['high'].rolling(window=30).max()
    low_30 = df['low'].rolling(window=30).min()
    
    heuristics_matrix = atr_ratio - (ema_30_volume * (high_30 - low_30))
    
    return heuristics_matrix
