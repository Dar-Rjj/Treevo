def heuristics_v2(df):
    # Calculate %K and %D for 20-day and 60-day Stochastic Oscillator
    lowest_20 = df['low'].rolling(window=20).min()
    highest_20 = df['high'].rolling(window=20).max()
    k_20 = 100 * (df['close'] - lowest_20) / (highest_20 - lowest_20)
    d_20 = k_20.rolling(window=3).mean()

    lowest_60 = df['low'].rolling(window=60).min()
    highest_60 = df['high'].rolling(window=60).max()
    k_60 = 100 * (df['close'] - lowest_60) / (highest_60 - lowest_60)
    d_60 = k_60.rolling(window=3).mean()

    stoch_ratio = d_20 / d_60

    # Adjust the 21-day EMA of the volume using the average of the last 21 days' high and low prices
    ema_21_volume = df['volume'].ewm(span=21, adjust=False).mean()
    mean_21_high_low = (df['high'] + df['low']).rolling(window=21).mean() / 2

    heuristics_matrix = stoch_ratio - (ema_21_volume * mean_21_high_low)

    return heuristics_matrix
