def heuristics_v2(df):
    ema_12_close = df['close'].ewm(span=12, adjust=False).mean()
    ema_26_close = df['close'].ewm(span=26, adjust=False).mean()
    macd_12_26 = ema_12_close - ema_26_close
    
    ema_12_macd = macd_12_26.ewm(span=12, adjust=False).mean()
    ema_26_macd = macd_12_26.ewm(span=26, adjust=False).mean()
    macd_10 = ema_12_macd - ema_26_macd
    
    ema_12_macd_2 = macd_10.ewm(span=12, adjust=False).mean()
    ema_26_macd_2 = macd_10.ewm(span=26, adjust=False).mean()
    macd_20 = ema_12_macd_2 - ema_26_macd_2
    
    macd_ratio = macd_10 / macd_20
    
    ema_5_amount = df['amount'].ewm(span=5, adjust=False).mean()
    mode_5_high = df['high'].rolling(window=5).apply(lambda x: pd.Series.mode(x)[0] if len(pd.Series.mode(x)) > 0 else np.nan)
    
    heuristics_matrix = macd_ratio - (ema_5_amount * mode_5_high)
    
    return heuristics_matrix
