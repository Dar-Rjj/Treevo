```python
import pandas as pd

def heuristics_v2(df, n=5, ema_span=10):
    intraday_range = df['high'] - df['low']
    close_to_intraday_range_ratio = df['close'] / intraday_range
    intraday_return = df['close'] - df['open']
    spread = df['high'] - df['low']
    volume_adjusted_spread = spread * df['volume']
    
    momentum_component = (df['close'].pct_change().rolling(window=n).sum()) * close_to_intraday_range_ratio
    
    volume_change = df['volume'] - df['volume'].shift(5)
    avg_volume_10_days = df['volume'].rolling(window=10).mean()
    volume_change_rate = volume_change / avg_volume_10_days
    dynamic_coefficient = pd.Series(index=df.index)
    dynamic_coefficient[volume_change_rate > 2] = 1.7
    dynamic_coefficient[volume_change_rate < 2] = -1.5
    dynamic_coefficient[(volume_change_rate >= -2) & (volume_change_rate <= 2)] = 0.8
    
    price_action_direction = pd.Series(0, index=df.index)
    ma_5 = df['close'].rolling(window=5).mean()
    ma_20 = df['close'].rolling(window=20).mean()
    price_action_direction[ma_5 > ma_20] = 1
    price_action_direction[ma_5 < ma_20] = -1
    momentum_price_action = momentum_component * price_action_direction
    
    ema_close = df['close'].ewm(span=ema_span, adjust=False).mean()
    exponential_price_trend = df['close'] - ema_close
    
    combined_signal = (intraday_return.mean() + volume_adjusted_spread)
    
    enhanced_combined_factor = (momentum_price_action * close_to_intraday_range_ratio * dynamic_coefficient 
                                / df['volume'].rolling(window=20).mean() 
                                * exponential_price_trend)
    
    open_to_close_return_today = df['close'] - df['open']
    overnight_gap = df['open'] - df['close'].shift(1)
    final_alpha_factor = enhanced_combined_factor - open_to_close_return_today - overnight_gap
    
    return final_alpha_factor
```
