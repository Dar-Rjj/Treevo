```python
import pandas as pd
import numpy as np

def heuristics_v2(df):
    # Price Momentum Factors
    df['SMA_5'] = df['close'].rolling(window=5).mean()
    df['SMA_20'] = df['close'].rolling(window=20).mean()
    df['SMA_Signal'] = df['SMA_20'] - df['SMA_5']
    
    df['EMA_5'] = df['close'].ewm(span=5, adjust=False).mean()
    df['EMA_20'] = df['close'].ewm(span=20, adjust=False).mean()
    df['EMA_Signal'] = df['EMA_20'] - df['EMA_5']
    
    # Volume-Weighted Price Factors
    def vwma(price, volume, window):
        return (price * volume).rolling(window=window).sum() / volume.rolling(window=window).sum()
    
    df['VWMA_5'] = vwma(df['close'], df['volume'], 5)
    df['VWMA_20'] = vwma(df['close'], df['volume'], 20)
    df['VWMA_Signal'] = df['VWMA_20'] - df['VWMA_5']
    
    df['VWP'] = (df['close'] * df['volume']).cumsum() / df['volume'].cumsum()
    df['VWP_Change'] = df['VWP'].pct_change(periods=10)
    
    # Volatility Factors
    df['Daily_Return'] = df['close'].pct_change()
    df['Std_20'] = df['Daily_Return'].rolling(window=20).std()
    
    df['True_Range'] = np.maximum(np.maximum(df['high'] - df['low'], abs(df['high'] - df['close'].shift())),
                                  abs(df['low'] - df['close'].shift()))
    df['ATR_14'] = df['True_Range'].rolling(window=14).mean()
    
    # Relative Strength Factors
    df['Pos_Return'] = df['Daily_Return'].apply(lambda x: max(x, 0))
    df['Neg_Return'] = df['Daily_Return'].apply(lambda x: -min(x, 0))
    
    df['Avg_Gain'] = df['Pos_Return'].ewm(span=14, adjust=False).mean()
    df['Avg_Loss'] = df['Neg_Return'].ewm(span=14, adjust=False).mean()
    df['RSI'] = 100 - (100 / (1 + (df['Avg_Gain'] / df['Avg_Loss'])))
    
    df['%K'] = 100 * ((df['close'] - df['low'].rolling(window=14).min()) / 
                      (df['high'].rolling(window=14).max() - df['low'].rolling(window=14).min()))
    df['%D'] = df['%K'].rolling(window=3).mean()
    
    # Volume Factors
    df['Volume_Change'] = df['volume'].pct_change(periods=10)
    df['Volume_5'] = df['volume'].rolling(window=5).mean()
    df['Volume_20'] = df['volume'].rolling(window=20).mean()
    df['Volume_Ratio'] = df['Volume_5'] / df['Volume_20']
    
    # Price and Volume Combined Factors
    df['Money_Flow_Multiplier'] = ((df['close'] - df['low']) - (df['high'] - df['close'])) / (df['high'] - df['low'])
    df['Money_Flow_Volume'] = df['Money_Flow_Multiplier'] * df['volume']
    df['CMF_20'] = df['Money_Flow_Volume'].rolling(window=20).sum() / df['volume'].rolling(window=20).sum()
    
    df['OBV'] = (np.sign(df['close'].diff()) * df['volume']).fillna(0).cumsum()
    
    # Pattern Recognition Factors
    def candlestick_pattern(close, open, high, low):
        doji = (abs(close - open) / (high - low)) < 0.005
        hammer = ((high - low) > 3 * (open - close)) & ((close - low) / (0.001 + high - low) > 0.6) & (
                (open - low) / (0.001 + high - low) > 0.6)
        engulfing_bullish = (close >=
