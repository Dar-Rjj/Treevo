```python
import pandas as pd

def heuristics_v2(df):
    # Calculate daily return
    df['daily_return'] = (df['close'] - df['open']) / df['open']
    
    # Sum of returns over a lookback window of N days
    N = 5
    df['N_day_return'] = df['daily_return'].rolling(window=N).sum()
    
    # True range calculation
    df['true_range'] = (df[['high', 'close']].shift(1).max(axis=1) - df[['low', 'close']].shift(1).min(axis=1))
    
    # Average true range (ATR) over M days
    M = 14
    df['atr'] = df['true_range'].rolling(window=M).mean()
    
    # Volume to average volume ratio
    L = 20
    df['avg_volume'] = df['volume'].rolling(window=L).mean()
    df['volume_intensity'] = df['volume'] / df['avg_volume']
    
    # Money flow over P days
    P = 10
    df['money_flow'] = df['volume'] * (2*df['close'] - df['high'] - df['low'])
    df['sum_money_flow'] = df['money_flow'].rolling(window=P).sum()
    
    # Composite factor with weights
    weight_N_day_return = 0.4
    weight_atr = 0.3
    weight_volume_intensity = 0.3
    
    df['composite_factor'] = (weight_N_day_return * df['N_day_return'] +
                              weight_atr * (1 / df['atr']) +
                              weight_volume_intensity * df['volume_intensity'])
    
    return df['composite_factor']
```
