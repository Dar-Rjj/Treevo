```python
import pandas as pd

def heuristics_v2(df):
    # Calculate the relative position of the closing price within the day's trading range
    df['range'] = df['high'] - df['low']
    df['close_position'] = (df['close'] - df['low']) / df['range']
    
    # Determine if the closing price is in the upper 20% of the day's range
    df['upper_close'] = df['close_position'] > 0.8
    
    # Check if the volume is above the 30-day moving average
    df['volume_30d_ma'] = df['volume'].rolling(window=30).mean()
    df['volume_above_ma'] = df['volume'] > df['volume_30d_ma']
    
    # Calculate the factor value: 
    # 1 if the closing price is in the upper 20% of the day's range and the volume is above the 30-day moving average
    # -1 if the closing price is in the lower 20% of the day's range and the volume is below the 30-day moving average
    # 0 otherwise
    df['factor_value'] = 0
    df.loc[df['upper_close'] & df['volume_above_ma'], 'factor_value'] = 1
    df.loc[(df['close_position'] < 0.2) & (~df['volume_above_ma']), 'factor_value'] = -1
    
    return df['factor_value']
```
