```python
import pandas as pd

def heuristics_v2(df, N=10, M=14, L=20, P=10, K=5):
    # Calculate daily return
    df['daily_return'] = (df['close'] - df['open']) / df['open']
    
    # Sum of returns over a lookback window of N days
    df['N_day_return'] = df['daily_return'].rolling(window=N).sum()
    
    # True range and ATR
    df['true_range'] = df[['high', 'close']].max(axis=1) - df[['low', 'close']].min(axis=1).shift(1)
    df['ATR_M'] = df['true_range'].rolling(window=M).mean()
    df['ATR_2M'] = df['true_range'].rolling(window=2*M).mean()
    df['relative_ATR'] = df['ATR_M'] / df['ATR_2M']
    
    # Volume intensity
    df['volume_intensity'] = df['volume'] / df['volume'].rolling(window=L).mean()
    
    # Money flow
    df['money_flow'] = df['volume'] * (2 * df['close'] - df['high'] - df['low'])
    df['P_day_money_flow'] = df['money_flow'].rolling(window=P).sum() * df['daily_return'].apply(lambda x: 1 if x > 0 else -1)
    
    # Composite factor
    df['composite_factor'] = 0.5 * df['N_day_return'] + 0.3 * df['relative_ATR'] + 0.2 * df['volume_intensity']
    
    # Volume-weighted return
    df['volume_weighted_return'] = df['daily_return'] * df['volume_intensity']
    df['N_day_volume_weighted_return'] = df['volume_weighted_return'].rolling(window=N).sum()
    
    # High-volume days price change
    high_volume_days = df['volume'] > df['volume'].rolling(window=L).mean()
    df['high_volume_price_change'] = df['close'] - df['close'].shift(1)
    df['N_day_high_volume_price_change'] = df['high_volume_price_change'][high_volume_days].rolling(window=N).sum()
    
    # Reversal factor
    df['price_range_K'] = df['high'].rolling(window=K).max() - df['low'].rolling(window=K).min()
    df['average_volume_K'] = df['volume'].rolling(window=K).mean()
    df['reversal_factor'] = (df['price_range_K'] > 2 * df['average_volume_K']).astype(int)
    
    # Return the composite factor
    return df['composite_factor']

# Example usage:
# df = pd.read_csv('your_data.csv', index_col='date', parse_dates=True)
# factor_values = heuristics_v2(df)
# print(factor_values)
```
