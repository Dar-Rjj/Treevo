```txt
Combined Price Momentum and Volume-Weighted Factor with Enhanced Volatility
├── Calculate Logarithmic Returns
│   ├── Use Close price
│   └── Compute log(close_t / close_(t-1))
├── Smoothing Logarithmic Returns
│   ├── Apply Exponential Moving Average (EMA)
│   │   ├── Input: Logarithmic Returns
│   │   └── Span: 5 days
│   ├── Store Smoothed Returns
├── Volume Shock Indicator
│   ├── Calculate Daily Volume Change
│   │   ├── Use Volume
│   └── Compute (volume_t - volume_(t-1)) / volume_(t-1)
│   ├── Identify Large Changes
│       ├── If |volume_change| > 2 * standard deviation of 7-day window
│       │   └── Assign 1 (Shock), else 0 (No Shock)
└── Weight by Volume and Price Volatility
    ├── Use Volume
    │   ├── Volume (t)
    │   ├── Volume (t-1)
    │   └── Volume (t-n)
    └── Calculate Price Volatility
        ├── Use High, Low, and Close prices
        │   ├── High (t)
        │   ├── Low (t)
        │   ├── Close (t)
        │   ├── High (t-1)
        │   ├── Low (t-1)
        │   └── Close (t-1)
        └── Average of True Range
            ├── True Range (t) = max(High (t) - Low (t), abs(High (t) - Close (t-1)), abs(Low (t) - Close (t-1)))
            └── Average True Range (ATR) over 7 days
    └── Combine Volume and Volatility
        ├── Multiply by Volume
        └── Multiply by ATR
    └── Multiply Smoothed Returns by Combined Weight
        ├── When Shock = 1, Keep the weighted return
        └── When Shock = 0, Set to 0
```
