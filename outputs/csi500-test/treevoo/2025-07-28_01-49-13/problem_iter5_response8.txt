```python
import pandas as pd
import numpy as np

def heuristics_v2(df, N=20, M=10, K=1.5, lookback=60):
    # Calculate Price Momentum with Intraday Volatility
    df['N_day_return'] = df['close'].pct_change(periods=N)
    df['intraday_high_low_range'] = (df['high'] - df['low']) / df['close']
    df['close_open_return'] = (df['close'] - df['open']) / df['open']
    df['combined_intraday_volatility'] = df['intraday_high_low_range'] + df['close_open_return']

    # Identify Volume Spike
    df['volume_moving_avg'] = df['volume'].rolling(window=M).mean()
    df['volume_std'] = df['volume'].rolling(window=M).std()
    df['volume_spike'] = (df['volume'] > (df['volume_moving_avg'] + 2 * df['volume_std'])).astype(int)

    # Combine Price Momentum, Intraday Volatility, and Volume Spike
    df['adjusted_return'] = df['N_day_return'] * (K if df['volume_spike'] else 1) * df['combined_intraday_volatility']

    # Calculate Volume Weighted Adjusted Return
    df['volume_weighted_adjusted_return'] = df['adjusted_return'] * df['volume']

    # Calculate Moving Average of Adjusted Return
    df['moving_average_adjusted_return'] = df['volume_weighted_adjusted_return'].rolling(window=lookback).mean()

    # Calculate Intraday Range to Open Ratio
    df['intraday_range_to_open_ratio'] = df['intraday_high_low_range'] / df['open']

    # Calculate Volume Momentum
    df['volume_momentum'] = (df['close'] / df['close'].shift(1)).rolling(window=N).sum() * df['volume']

    # Calculate High-Low Envelope
    df['max_high'] = df['high'].rolling(window=N).max()
    df['min_low'] = df['low'].rolling(window=N).min()

    # Combine Factors
    df['factor'] = (df['volume_weighted_adjusted_return'] / df['moving_average_adjusted_return']) * \
                   (df['intraday_range_to_open_ratio'] * df['volume_momentum']) * \
                   (df['max_high'] - df['min_low'])

    return df['factor']
```
