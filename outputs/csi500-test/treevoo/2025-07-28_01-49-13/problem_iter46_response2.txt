```python
import pandas as pd

def heuristics_v2(df):
    # Momentum-based factors
    df['EMA_5'] = df['close'].ewm(span=5, adjust=False).mean()
    df['EMA_20'] = df['close'].ewm(span=20, adjust=False).mean()
    df['EMA_Diff'] = df['EMA_5'] - df['EMA_20']
    df['ROC_5'] = df['close'].pct_change(5)
    df['ROC_10'] = df['close'].pct_change(10)

    # Volume-based factors
    df['Volume_Ratio_5'] = df['volume'] / df['volume'].rolling(window=5).median()
    df['Volume_Ratio_20'] = df['volume'] / df['volume'].rolling(window=20).median()
    df['Volume_Momentum'] = df['volume'].pct_change(1)
    df['Volume_ROC_5'] = df['volume'].pct_change(5)
    df['Volume_ROC_10'] = df['volume'].pct_change(10)

    # Price and volume combined factors
    df['OBV'] = (df['close'] > df['close'].shift(1)).astype(int) * df['volume'] - (df['close'] < df['close'].shift(1)).astype(int) * df['volume']
    df['OBV'] = df['OBV'].cumsum()
    df['VWAP_5'] = (df['close'] * df['volume']).rolling(window=5).sum() / df['volume'].rolling(window=5).sum()
    df['VWAP_20'] = (df['close'] * df['volume']).rolling(window=20).sum() / df['volume'].rolling(window=20).sum()
    df['Close_VWAP_5_Diff'] = df['close'] - df['VWAP_5']
    df['Close_VWAP_20_Diff'] = df['close'] - df['VWAP_20']

    # Volatility-based factors
    df['MAD_5'] = df['close'].rolling(window=5).apply(lambda x: (x - x.mean()).abs().mean(), raw=True)
    df['MAD_20'] = df['close'].rolling(window=20).apply(lambda x: (x - x.mean()).abs().mean(), raw=True)
    df['True_Range'] = df[['high', 'low']].diff(axis=1).iloc[:, 0].abs()
    df['Average_True_Range_5'] = df['True_Range'].rolling(window=5).mean()
    df['Average_True_Range_20'] = df['True_Range'].rolling(window=20).mean()

    # Pattern recognition factors
    df['Doji'] = (df['open'] == df['close']).astype(int)
    df['Hammer'] = ((df['close'] - df['low']) / (df['high'] - df['low']) > 0.66) & ((df['high'] - df['close']) / (df['high'] - df['low']) < 0.33) & (df['close'] > df['open'])
    df['Shooting_Star'] = ((df['high'] - df['close']) / (df['high'] - df['low']) > 0.66) & ((df['close'] - df['low']) / (df['high'] - df['low']) < 0.33) & (df['close'] < df['open'])
    df['Engulfing'] = ((df['close'] > df['open']) & (df['close'].shift(1) < df['open'].shift(1)) & (df['close'] > df['open'].shift(1)) & (df['open'] < df['close'].shift(1))) | \
                      ((df['close'] < df['open']) & (df['close'].shift(1) > df['open'].shift(1)) & (df['close'] < df['open'].shift(1)) & (df['open'] > df['close'].shift(1)))
    df['Trend_High_5'] = df['high'].rolling(window=5).max()
    df['Trend_Low_5'] = df['low'].rolling(window=5).min()
    df['Trend_Close_5'] = df['close'].rolling(window=5).mean()

    # Combine all factors into a single alpha factor
    alpha_factor = df['EMA_Diff'] + df['ROC_5'] + df['Volume_Ratio_5
