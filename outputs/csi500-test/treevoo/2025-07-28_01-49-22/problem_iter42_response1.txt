```python
import pandas as pd

def heuristics_v2(df):
    # Calculate the 5-day and 20-day rate of change in closing prices
    df['close_5d_roc'] = df['close'].pct_change(5)
    df['close_20d_roc'] = df['close'].pct_change(20)
    
    # Calculate the percentage change in volume over consecutive days
    df['volume_1d_pct_chg'] = df['volume'].pct_change()
    
    # Calculate the difference between high and low prices (intraday range)
    df['high_low_range'] = df['high'] - df['low']
    
    # Calculate the average range (high-low) over a specified period (e.g., 20 days)
    df['avg_high_low_range_20d'] = df['high_low_range'].rolling(window=20).mean()
    
    # Create a sentiment factor by comparing opening and closing prices
    df['sentiment_factor'] = (df['close'] > df['open']).astype(int)
    
    # Calculate the average gap between open and close prices over a specified period (e.g., 20 days)
    df['avg_gap_open_close_20d'] = df[['open', 'close']].apply(lambda x: abs(x['open'] - x['close']), axis=1).rolling(window=20).mean()
    
    # Generate a factor that captures the frequency and magnitude of large transaction amounts
    df['large_transaction_amount'] = (df['amount'] > df['amount'].mean() + 2 * df['amount'].std()).astype(int)
    
    # Composite factor: Weighted sum of short-term price momentum and volume percentage change
    df['composite_factor'] = 0.7 * df['close_5d_roc'] + 0.3 * df['volume_1d_pct_chg']
    
    # Drop rows with NaN values created by rolling calculations
    df.dropna(inplace=True)
    
    return df['composite_factor']

# Example usage:
# df = pd.read_csv('your_data.csv', index_col='date', parse_dates=True)
# composite_factor = heuristics_v2(df)
# print(composite_factor)
```
